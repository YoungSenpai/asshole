window.requestFileSystem||(window.requestFileSystem=window.webkitRequestFileSystem);
Registry.require("promise layout convert xmlhttprequest crcrc curtain tools layout/default/tabview layout/default/htmlutil helper statistics i18n syncinfo uri layout/default/layout_helper porter hinter cloud".split(" "),function(){var z=rea.FEATURES,D=Registry.get("promise"),w=Registry.get("crcrc").cr,g=Registry.get("crcrc").crc,Oa=Registry.get("layout/default/tabview"),p=Registry.get("layout/default/htmlutil"),jb=Registry.get("statistics"),Pa=Registry.get("syncinfo"),kb=Registry.get("convert"),za=
Registry.get("tools"),q=Registry.get("curtain"),e=Registry.get("i18n"),v=Registry.get("helper"),Aa=Registry.get("uri"),aa=Registry.get("porter"),Ba=Registry.get("hinter"),Ca=Registry.get("layout"),ma=Registry.get("layout/default/layout_helper"),C=ma.images,na=Registry.get("cloud"),Da=za.cache;Ca.render(function(){ma.addStyle();var ta={},t={},H=[],Ea="0.0.0",W={},Qa={},U={},ea=!0,fa=z.HTML5.LOCALSTORAGE?"true"===z.HTML5.LOCALSTORAGE.getItem("export_tm_settings"):!1,I,u={},P=function(a,b){var c,d;if((c=
u[a])&&(d=c[b]))return d.apply(this,Array.prototype.slice.call(arguments,2))},ga=-1!=window.navigator.userAgent.indexOf("Mac")?"mac":"other";window.addEventListener("keydown",function(a){var b,c=!1;if("keydown"==a.type&&!a.defaultPrevented){if(27==a.keyCode){b=I.getTabById("dashboard");if(!b.isSelected())return;if(a.target&&"text"==a.target.type){$(a.target).blur();return}u.multiselect.toggleRow(!1);c=!0}else if(("mac"!=ga&&39==a.keyCode||"mac"==ga&&40==a.keyCode)&&!a.ctrlKey&&a.altKey&&!a.shiftKey){if(b=
I.getNextTab())b.select(),c=!0}else("mac"!=ga&&37==a.keyCode||"mac"==ga&&38==a.keyCode)&&!a.ctrlKey&&a.altKey&&!a.shiftKey&&(b=I.getPreviousTab())&&(b.select(),c=!0);if(c)return a.stopPropagation(),a.preventDefault(),!1}},!0);window.addEventListener("keydown",function(a){var b,c,d=!1;if("keydown"==a.type&&!a.defaultPrevented){if(112==a.keyCode)(b=I.getTabById("help"))&&b.select(),d=!0;else if((38==a.keyCode||40==a.keyCode)&&a.shiftKey){b=I.getTabById("dashboard");if(!b.isSelected())return;if((b=S.length&&
S[S.length-1])&&(b=$(b))&&(d=!0,c=b.closest("tr"),c.length)){var h;38==a.keyCode?(c=c.prevAll("tr:visible:first"),h=!0):(c=c.nextAll("tr:visible:first"),h=!1);if(c.length){var f,e=c.find('input[name="scriptselectors"]');-1!=S.indexOf(e[0])?(S.pop(),b.prop("checked",!1),b.removeClass("selected"),f=b):e.length&&(e.prop("checked",!0),e.addClass("selected"),S.push(e[0]),void 0===S.direction&&(S.direction=h),f=e);f&&(p.isScrolledIntoView(c,{padding:100})||$("html, body").animate({scrollTop:h?c.offset().top-
100-c.height():c.offset().top-$(window).height()+100+2*c.height()},0),u.multiselect.single_click())}}}else if(70==a.keyCode&&(a.ctrlKey||a.metaKey)){b=I.getTabById("dashboard");if(!b.isSelected())return;u.multiselect.toggleRow(!0,!0);d=!0}else if(65==a.keyCode&&(a.ctrlKey||a.metaKey)){b=I.getTabById("dashboard");if(!b.isSelected()||a.target&&"text"==a.target.type)return;u.multiselect.un_selectAll(!0);d=!0}if(d)return a.stopPropagation(),a.preventDefault(),!1}},!1);var X,M=function(){var a={};window.onhashchange=
function(){X=v.getUrlArgs(!0);Object.keys(a).forEach(function(d){d=a[d];b.is(d.main,d.sub)&&d.fn()})};window.onhashchange();var b={set:function(a){var c=b.get(),f;f="object"===typeof a?[a.main,a.sub].filter(function(a){return a}):arguments;if(c.main!==f[0]||c.sub!==f[1])!f[0]&&f[1]?b.setSub(f[1]):window.location.hash="nav="+Array.prototype.join.call(f,"+")},setSub:function(a){var c=b.get();c.sub!==a&&(window.location.hash="nav="+(c.main?c.main:"")+"+"+a)},get:function(){var a=X.nav?X.nav.split("+"):
[];return{main:a[0],sub:a[1]}},is:function(a,c){var f=b.get(),e=!c||f.sub===c;return(!a||f.main===a)&&e},isSub:function(a){return b.is(null,a)},registerListener:function(c,h,e){void 0===e&&(e=h,h=null);var l=[c,h].join("+");a[l]={main:c,sub:h,fn:e};b.is(c,h)&&e();return l},unregisterListener:function(b){delete a[b]},clear:function(){b.set("")}},c=b.get();H.push(function(){var a=I.getTabById(c.main);if(a)return a.select();if(c.main)(a=I.getTabById("dashboard"))&&a.select(),H.push(function(){window.setTimeout(function(){b.set(c)},
1)});else window.onhashchange()});return b}();(function(){H.push(function(){t.statistics_enabled&&jb.init("opt",Ea)})})();var Fa=v.getDebouncer(1E3),Ga=function(){for(;H.length;)try{H.shift()()}catch(a){console.warn("doneListeners:",a)}},za=function(a,b){var c=w("input",a.name,a.id,"Save");c.inserted||(c.type="button",c.section=a,c.value=e.getMessage("Save"),c.addEventListener("click",function(){if(!b||!b.warning||oa(b.warning)){var a=Array.prototype.slice.call(this.section.getElementsByTagName("textarea")),
c=function(b){b.each(function(b,c){a.push(c)})};c($("#"+this.section.id).find("input"));c($("#"+this.section.id).find("select"));for(var c=[],e=[],l=0;l<a.length;l++){var m=null,k=a[l],r=k.key;if(-1==e.indexOf(k)){if("textarea"==k.tagName.toLowerCase())k.named?(k=document.getElementsByName(k.name),m=[],v.each(k,function(a){m.push({name:a.named_name,value:a.value});e.push(a)})):m=k.array?k.value.split("\n").map(function(a){return a.trim()}).filter(function(a){return a}):k.value;else if("checkbox"==
k.getAttribute("type"))m=k.checked;else if("select"==k.getAttribute("type")){var n=0;0<=k.selectedIndex&&k.selectedIndex<k.options.length&&(n=k.selectedIndex);m=k[n]?k[n].value:k.options[0].value}else"button"!=k.getAttribute("type")&&(m=k.value);r&&c.push(ua(r,m,b&&b.reload))}}b&&b.reload&&(q.wait(),D.when(c).done(function(){rea.page.reload()}))}},!1));return c},nb=function(a){var b=function(a,b,c,d,k){var h,e=g("th","settingsth",a.name,a.id,b),f=g("a","settingsth_a",a.name,a.id,b+"_a");f.setAttribute("name",
"settingsth_a"+a.name);var l=g("a","settingsth_a_up",a.name,a.id,b+"_a_up");l.setAttribute("name","settingsth_a_up"+a.name);var A=g("a","settingsth_a_down",a.name,a.id,b+"_a_down");A.setAttribute("name","settingsth_a_down"+a.name);var r=function(){var b=document.getElementsByName("settingsth_a_up"+a.name),c=document.getElementsByName("settingsth_a_down"+a.name);for(h=0;h<b.length;h++)b[h].style.display="none";for(h=0;h<c.length;h++)c[h].style.display="none";"up"==ha()?l.style.display="":A.style.display=
""},n=function(){r()};b=function(){window.setTimeout(function(){da()==d?Sa("down"==ha()?"up":"down"):Ta(d);Ua(n)},1)};e.inserted||(e.appendChild(f),e.appendChild(A),e.appendChild(l),f.addEventListener("click",b),l.addEventListener("click",b),A.addEventListener("click",b),f.textContent=c+" ",f.href="#",l.innerHTML="&#x25B4;",l.href="#",A.innerHTML="&#x25BE;",A.href="#");k&&!da()?(Ta(d),Sa("up"),window.setTimeout(r,1)):d==da()&&window.setTimeout(r,1);return e},c,d,h,f,l;f=w("tbody",a.name,a.id,"body");
l=w("thead",a.name,a.id,"head");if(a.scriptTab){var m=lb(a),k=mb(a);c=w("table",a.name,a.id,"main");c.inserted||c.setAttribute("class","scripttable multiselect");var r=g("th","script_sel",a.name,a.id,"thead_sel");r.appendChild(m.selAllm);var n=g("th","left",a.name,a.id,"thead_multi_action");n.setAttribute("colspan",z.RUNTIME.MOBILE?3:11);n.appendChild(m.actionBox);n.appendChild(k);k=g("th","right",a.name,a.id,"thead_multi_close");k.appendChild(m.close);h=g("tr","multiselectrow",a.name,a.id,"filler_multi");
h.appendChild([r,n,k]);d=g("tr","scripttr multiselectreplaced",a.name,a.id,"filler");r=g("th","script_sel",a.name,a.id,"thead_sel");r.appendChild(m.selAll);var m=b(a,"thead_pos","#","pos"),n=b(a,"thead_en",e.getMessage("Enabled"),"enabled"),k=b(a,"thead_name",e.getMessage("Name"),"name",!0),E=g("th","settingsth",a.name,a.id,"thead_del");E.textContent=e.getMessage("Actions");if(z.RUNTIME.MOBILE)v.each([r,m,n,k,E],function(a){d.appendChild(a)});else{var K=b(a,"thead_ver",e.getMessage("Version"),"ver"),
A=g("th","settingsth ",a.name,a.id,"thead_type"),y=g("span","script_type",a.name,a.id,"thead_type_span");y.textContent=e.getMessage("Type");A.appendChild(y);var G=g("th","settingsth",a.name,a.id,"thead_sync");G.textContent="";y=b(a,"thead_sites",e.getMessage("Sites"),"sites");y.width="25%";var p=g("th","settingsth",a.name,a.id,"thead_features");p.textContent=e.getMessage("Features");var x=b(a,"thead_homepage",e.getMessage("Homepage"),"homepage"),b=b(a,"thead_updated",e.getMessage("Last_updated"),
"updated"),q=g("th","settingsth",a.name,a.id,"thead_sort");a=g("span","sorting",a.name,a.id,"thead_sort_span");a.textContent=e.getMessage("Sort");"pos"==da()&&"up"==ha()||a.setAttribute("style","display: none;");q.appendChild(a);H.push(function(){t.sync_enabled&&(G.textContent=e.getMessage("Imported"))});v.each([r,m,n,k,K,A,G,y,p,x,b,q,E],function(a){d.appendChild(a)})}l.appendChild(h);l.appendChild(d);d.inserted||(u.multiselect.checkScroll=function(){var a=$(l).is(":visible")&&$(h).is(":visible")&&
$(window).scrollTop()>$(l).offset().top;$(h).toggleClass("multiscrolling",a)},$(window).scroll(u.multiselect.checkScroll))}else c=g("table","settingstable",a.name,a.id,"main");c.appendChild(l);c.appendChild(f);return{table:c,head:l,body:f}},Va=function(a,b,c,d){var h,e,l,m,k,r=[];if(b.divider)return null;b.image&&(b.image_id=C.get(b.image));if(b.checkbox)l=function(){var a=!0,b=this;b.warning&&(a=oa(b.warning),a||(b.checked=!b.checked));a&&ua(this.key,b.checked,b.reload).always(function(){b.reload&&
rea.page.reload()})},c&&c.need_save&&(l=e=null),h=p.createCheckbox(b.name,b,l),r.push(h.elem);else if(b.button)h=p.createButton(b.name,b,function(){var a=!0,b=this;b.warning&&(a=oa(b.warning));a&&ob(b.key,b.data,b.ignore).always(function(){b.reload&&rea.page.reload()})}),r.push(h);else if(b.named)h=p.createNamedSettings(b.name,b),r.push({element:h.elem,validation:h.label}),c&&(c.need_save=!0);else if(b.input)h=p.createTextarea(b.name,b),r.push({element:h.elem,validation:h.label}),c&&(c.need_save=
!0);else if(b.text)h=p.createInput(b.name,b),r.push(h.elem),c&&(c.need_save=!0);else if(b.color)h=p.createColorChooser(b.name,b),r.push(h.elem),c&&(c.need_save=!0);else if(b.password)h=p.createPassword(b.name,b),r.push(h.elem),c&&(c.need_save=!0);else if(b.select)e=function(){var a=!0,b=this;b.warning&&(a=oa(b.warning),a||(b.value=b.oldvalue));a&&ua(b.key,p.getValue(b),b.reload).always(function(){b.reload&&rea.page.reload()})},c&&c.need_save&&(e=b.enabler?function(){var a=document.getElementsByName("enabled_by_"+
this.key),b=(this.selectedIndex<this.options.length?this.options[this.selectedIndex]:this.options[0]).getAttribute("enables"),c=b?JSON.parse(b):{};v.each(a,function(a){void 0===c[a.key]||c[a.key]?a.setAttribute("style",v.staticVars.visible):a.setAttribute("style",v.staticVars.invisible)})}:null),h=p.createDropDown(b.name,b,b.select,e,function(){var a=!0;this.selectedOptions.length&&this.selectedOptions[0].warning&&this.selectedOptions[0].value!==this.oldvalue&&(a=oa(this.selectedOptions[0].warning),
a||(this.value=this.previousValue||this.oldvalue));this.previousValue=this.value}),r.push(h.elem),a&&b.enabler&&function(){var a=e,b=h;H.push(function(){a.apply(b.select,[])})}();else if(b.url)l=w("a",b.name,b.id),l.href="#",l.url=b.url,l.newtab=b.newtab,l.inserted||(e=function(){va(this.url,this.newtab)},l.addEventListener("click",e)),l.textContent=b.name,r=Array(13),r[3]=l;else if(b.main_menu_item){l=w("div",b.name,b.id);l.textContent=b.name;m=nb(b);k=w("div",b.name,b.id,"tab_content");k.appendChild(m.table);
var n=null,E=d.appendTab(b.id,l,k,function(){n&&(ta.global?n():H.push(n));M.set(b.id);document.title=b.name});M.registerListener(b.id,function(){E.select()});b.referrer&&(n=function(){n=null;q.wait();qa({referrer:b.referrer},function(b){b.items&&b.items.forEach(function(b){Va(a,b,c,d)});Ga();q.hide()})});b.items&&wa(m.body,b.items,null,d);!ta.global&&b.selected_default&&H.push(function(){d.getSelectedTab()||E.select()})}else b.sub_menu_item?(m=g("div","section",b.name,b.id,"section"),l=g("div","section_head",
b.name,b.id,"head"),k=g("table","section_content",b.name,b.id,"content"),l.textContent=b.name,m.appendChild(l),b.desc&&p.setHelp(b.desc,l,l,b),m.appendChild(k),wa(k,b.items,b,d),b.need_save&&k.appendChild(za(k,b)),r.push(m)):b.userscript||b.nativeScript?(r=pb(b,a,d),b.userscript&&(U[b.uuid]={dom:a,script:b}),a.setAttribute("class","scripttr"),b.nnew?a.setAttribute("style","display: none;"):Fa.is("script_refresh")||(H.push(function(){Ha.init(v.map(U,function(a){return a.script}));u.multiselect.single_click();
Ua();ta.scripts=!0;Fa.clear()}),Fa.add("script_refresh")),b.nativeScript&&$("body").addClass("show_script_type")):b.version?(Ea=b.value,g("div","version","version","version").textContent="v"+Ea+" by Jan Biniok"):b.globalhint?Wa({class:b.class,text:b.value,title:b.description,onclick:b.info_url?function(){va(b.info_url,!0)}:null,image:b.image}):(l=w("span","",b.uuid||b.id+b.name),l.textContent=b.name,r=Array(13),r[3]=l);r.forEach(function(a){if(a){void 0!==b.level&&(a.element||a).setAttribute("style",
b.level>t.configMode?v.staticVars.invisible:v.staticVars.visible||"");if(b.hint){var c=w("span","",b.uuid||b.id+b.name,"hint");c.textContent=b.hint;a.appendChild(c)}b.validation&&qb(b,a.validation||a.element||a);b.width&&a.setAttribute("class","width-172-"+b.width)}});a&&(k=a.getAttribute("class"),l=" hide",!1===b.visible?k=(k||"")+l:k&&(k=k.replace(l,"")),a.setAttribute("class",k));return r},wa=function(a,b,c,d){Object.keys(b).forEach(function(e){var f=b[e],l=a?g("tr","settingstr",f.uuid||f.id+f.name,
"pi"):null;(e=Va(l,f,c,d))&&e.length&&(a&&a.appendChild(l),v.each(e,function(a,b){var c=a,d="";"Object"===v.toType(a)&&(c=a.element,d=a.style||"");d=g("td",d+" settingstd","",f.uuid||f.id+f.name,b);a&&d.appendChild(c);l&&l.appendChild(d)}))})},oa=function(a){var b=a.msg||a;if(a.once){if(Qa[b])return!0;Qa[b]=!0}var b=confirm(b),c={};b&&a.ok?c=a.ok:!b&&a.cancel&&(c=a.cancel);if(a.ok||a.cancel)b=!0;c.url&&sendMessage({method:"newTab",url:c.url},function(){});return b},qb=function(a,b){var c;a.validation&&
(a.validation.url&&(c=function(){va(this.url,!0)}),c=p.createAfterIcon(a,c))&&(c.url=a.validation?a.validation.url:void 0,b.appendChild(c))},rb=function(a){return{source:a.code,meta:{name:a.name,uuid:a.uuid,modified:a.lastModified,file_url:a.file_url&&a.file_url.trim()?a.file_url:void 0},storage:a.storage,options:a.options,settings:{enabled:a.enabled,position:a.position}}},xa=function(a,b){var c=D(),d=[];sb(a,b).done(function(a){a.scripts.forEach(function(a){a.uuid&&a.userscript&&!a.system&&!a.nnew&&
(a.code&&""!=a.code.trim()?d.push(rb(a)):console.log("options: Strange script: "+a.name))});c.resolve({scripts:d,global_settings:a.global_settings})}).fail(function(){c.reject()});return c.promise()},tb=function(a){var b,c,d=w("div","help","help","tab_help_h"),h=d.textContent=e.getMessage("Help"),f=w("div","help","help","tab_help");return a.appendTab("help",d,f,function(){M.set("help");document.title=h;if(!c){q.wait();var a=g("div","section","help","help","ta"),d=g("div","section_head","help","help",
"head_ta"),k=g("div","section_content","help","help","content_ta");d.textContent=e.getMessage("Editor");a.appendChild([d,k]);var r=g("dl","dl-horizontal shortcuts","help","help","dl");k.appendChild(r);d=g("dt","keymapping","help","help","dt_mapping");b=g("dd","keymapping","help","help","dd_mapping");d.textContent=e.getMessage("Key_Mapping");b.textContent=t.editor_keyMap;r.appendChild([d,b]);if("vim"==t.editor_keyMap)b=g("dd","keymapping","help","help","dd_unsup"),b.textContent=e.getMessage("Please_check_the_0editor0_documentation_for_more_details_",
"VIM"),r.appendChild(b);else if("emacs"==t.editor_keyMap)b=g("dd","keymapping","help","help","dd_unsup"),b.textContent=e.getMessage("Please_check_the_0editor0_documentation_for_more_details_","Emacs"),r.appendChild(b);else{var n=[];c={};var E=function(a){a=a.split(/-+/);var b=a.pop(),c=[],d="";-1!=(d=["up","down","left","right"].indexOf(b.toLowerCase()))&&c.push("#cursor");b.toLowerCase().match(/f[0-9]{1,2}/)&&c.push("#function");return c.length?c.join("-")+a.join("-")+d+b:("0000"+(100-Math.min(b.length,
4))).slice(-4)+b+a.join("-")};[v.assign({Esc:"backOrClose"},"mac"!=ga?{"Alt-Left":"previousTab","Alt-Right":"nextTab"}:{"Alt-Up":"previousTab","Alt-Down":"nextTab"}),CodeMirror.keyMap[t.editor_keyMap],"mac"!=ga?CodeMirror.keyMap.pcDefault:CodeMirror.keyMap.macDefault,CodeMirror.keyMap["default"]].forEach(function(a){Object.keys(a).forEach(function(b){c[b]||"fallthrough"==b||(n.push({name:b,fn:a[b].replace?a[b].replace(/([A-Z])/g," $1").replace(/ [A-Z]/g,function(a){return a.toLowerCase()}):a[b],sort:E(b)}),
c[b]=!0)})});n.sort(function(a,b){return a.sort<b.sort?-1:a.sort>b.sort?1:0});n.forEach(function(a){var b=w("dt","help","help","dt_"+a.sort),c=w("dd","help","help","dd_"+a.sort);b.textContent=a.name;c.textContent=a.fn;r.appendChild([b,c])})}f.appendChild(a);q.hide()}})},ra=function(){if(z.RUNTIME.FIREFOX)return window.saveAs=function(a,c){var d=URL.createObjectURL(a);ub(d,c,function(){URL.revokeObjectURL(d)})},D.Pledge();if(z.RUNTIME.EDGE&&window.navigator&&window.navigator.msSaveBlob)return window.saveAs=
function(a,c){window.navigator.msSaveBlob(a,c)},D.Pledge();var a=D();Registry.vendor(["vendor/saveas/filesaver"],function(){ra=D.Pledge;a.resolve()});return a.promise()},wb=function(a){var b=w("div","utils","utils","tab_util_h"),c=b.textContent=e.getMessage("Utilities"),d=w("div","utils","utils","tab_util");a.appendTab("utils",b,d,function(){M.set("utils");document.title=c}).show();a=g("div","tv_util","utils","utils","tab_util_cont");var h=function(){na.init(function(a){var b=D(),c=rea.extension.connect("tabWatch");
c.onMessage.addListener(function(a){(a=a.tab)?b.notify(a):(c.disconnect(),b.resolve())});c.onDisconnect.addListener(function(){b.reject("auth_failed")});c.postMessage({method:"tabWatch",type:a.type,url:a.url});return{promise:b.promise(),close:function(){c.disconnect()}}});h=null},f=function(){return xa(null,{storage:ea,global_settings:fa}).then(function(a){q.wait();return aa.zip.create(a.scripts,a.global_settings).progress(q.wait)})},l=function(a){var b=D(),c=new FileReader;c.onload=function(a){b.resolve(a.target.result)};
c.readAsText(a);return b.promise()},m=function(a){for(var b=0,c;c=a[b];b++)aa.zip.read(c).progress(q.wait).then(function(a){return Ia({scripts:v.map(a.scripts,function(a){var b=a.meta||{},c=a.settings||{};return{source:a.source,name:b.name,uuid:b.uuid,file_url:b.file_url,options:a.options,storage:a.storage,lastModified:b.modified,enabled:c.enabled,position:c.position}}),global_settings:a.global_settings},{reload:!0})}).done(function(a){a.err&&v.alert(a.err)}).fail(function(){v.alert(e.getMessage("Unable_to_parse_this_"))}).always(q.hide)},
k=p.createButton("utils","utils_i_ta",e.getMessage("Import"),function(){aa.json.read(u.value).then(function(a){return Ia(a,{reload:!0})}).done(function(a){a.err&&v.alert(a.err)}).fail(function(){v.alert(e.getMessage("Unable_to_parse_this_"))})}),r=p.createFileSelect(e.getMessage("Import"),{name:"zip",id:"utils"},function(a){q.wait();return m(a)}),n=p.createFileSelect(e.getMessage("Import"),{name:"file",id:"utils"},function(a){q.wait();for(var b,c=0;b=a[c];c++)l(b).then(function(a){return aa.json.read(a)}).then(function(a){return Ia(a,
{reload:!0})}).done(function(a){a.err&&v.alert(a.err)}).fail(function(){v.alert(e.getMessage("Unable_to_parse_this_"))}).always(q.hide)}),E=p.createButton("utils","utils_i_cloud",e.getMessage("Show_backups"),function(){q.wait();var a=B.select.value,b=B.select.selectedOptions[0].text;h&&h();na[a].list().progress(function(a){0<a.total&&q.wait(b+": "+Math.floor(a.loaded/a.total*100)+"%")}).then(function(a){a=a.filter(function(a){return a.name.match(/\.zip$/)});return a.length?a:D().reject("empty")}).then(function(b){var c=
D(),d=$('<table class="nowrap file_select">');$('<thead><tr><th colspan="3">'+e.getMessage("Please_select_a_file")+":</th></tr></thead>").appendTo(d);b.sort(function(a,b){return a.modified-b.modified}).forEach(function(b){var k=$('<input class="button" type="button" value="'+e.getMessage("Import")+'">').click(function(){c.resolve(b);q.hideDialog();q.wait()}),h=$('<input class="button" type="button" value="'+e.getMessage("Delete")+'">').click(function(){f.hide();na[a].delete(b)}),f=$("<tr><td>"+[p.safeTagsReplace(b.name),
ma.formatBytes(b.size,2),(new Date(b.modified)).toLocaleString().replace((new Date).toLocaleDateString(),e.getMessage("Today"))].join("</td><td>")+"</td></tr>");$("<td>").append(k,h).appendTo(f);f.appendTo(d)});b=$('<input class="button" type="button" value="'+e.getMessage("Cancel")+'">').click(function(){c.reject("cancel");q.hideDialog()});$("<tfoot>").append($("<tr>").append($('<td colspan="3">').append(b))).appendTo(d);q.hide();q.dialog(d[0]);return c.promise()}).then(function(c){return na[a].get(c).progress(function(a){0<
a.total&&q.wait(b+": "+Math.floor(a.loaded/a.total*100)+"%")})}).then(function(a){return m([a])}).fail(function(a){var b;"empty"===a?b=e.getMessage("No_backups_found"):"cancel"!=a&&("auth_failed"==a?console.warn("cloud: Authentication failed"):b=e.getMessage("Error")+": "+a);b&&v.alert(b);q.hide()})}),b=p.createButton("utils","utils_i_url",e.getMessage("Import"),function(){q.wait();return vb(C.value,{reload:!0}).fail(function(a){a=a.err?a.err:e.getMessage("Unable_to_parse_this_");v.alert(a)}).always(q.hide)}),
K=p.createButton("utils","utils_e_ta",e.getMessage("Export"),function(){q.wait();xa(null,{storage:ea,global_settings:fa}).then(function(a){return aa.json.create(a.scripts,a.global_settings)}).done(function(a){u.value=a}).always(q.hide)}),A=p.createButton("utils","utils_e_file",e.getMessage("Export"),function(){q.wait();xa(null,{storage:ea,global_settings:fa}).then(function(a){return aa.json.create(a.scripts,a.global_settings).then(function(a){return ra().done(function(){var b=new Blob([a],{type:"text/plain"});
saveAs(b,"tampermonkey-backup-"+z.RUNTIME.BROWSER+"-"+(new Date).toISOString()+".txt")})})}).always(q.hide)}),y=p.createButton("utils","utils_e_zip",e.getMessage("Export"),function(){return f().then(function(a){return ra().done(function(){saveAs(a,v.safeFileName("tampermonkey-backup-"+z.RUNTIME.BROWSER+"-"+(new Date).toISOString()+".zip"))})}).always(q.hide)}),G=p.createButton("utils","utils_e_zip",e.getMessage("Export"),function(){var a=D(),b=B.select.value,c=B.select.selectedOptions[0].text,d=function(a){return f().then(function(d){q.wait(c+
"...");h&&h();return na[b].put(a+".zip",d).progress(function(a){0<a.total&&q.wait(c+":"+Math.floor(a.loaded/a.total*100)+"%")})}).fail(function(a){v.alert(e.getMessage("Error")+": "+a)}).always(q.hide)};v.prompt(e.getMessage("Name"),"backup-"+z.RUNTIME.BROWSER+"-"+(new Date).toISOString(),function(b){b?a.consume(d(b)):a.reject("aborted")});return a.promise()}),ca=p.createCheckbox(e.getMessage("Include_TM_settings"),{id:"utils_e_export_tm_settings",enabled:"true"},function(){fa=this.checked;z.HTML5.LOCALSTORAGE&&
z.HTML5.LOCALSTORAGE.setItem("export_tm_settings",fa)});ca.elem.setAttribute("style","padding-left: 2px");ca.input.checked=fa;var x=p.createCheckbox(e.getMessage("Include_script_storage"),{id:"utils_e_export_storage",enabled:"true"},function(){ea=this.checked});x.elem.setAttribute("style","padding-left: 2px; display: inline");x.input.checked=ea;var u=g("textarea","importta","utils","utils","ta");u.setAttribute("spellcheck","false");var pa=g("div","section","utils","utils","ta"),Q=g("div","section_head",
"utils","utils","head_ta"),F=g("div","section_content","utils","utils","content_ta");Q.textContent=e.getMessage("General");F.appendChild(x.elem);F.appendChild(ca.elem);pa.appendChild(Q);pa.appendChild(F);ca=g("div","section","utils","utils","ta");x=g("div","section_head","utils","utils","head_ta");Q=g("div","section_content","utils","utils","content_ta");x.textContent=e.getMessage("TextArea");Q.appendChild(K);Q.appendChild(k);Q.appendChild(u);ca.appendChild(x);ca.appendChild(Q);k=g("div","section",
"utils","utils","sb");K=g("div","section_head","utils","utils","head_sb");x=g("div","section_content","utils","utils","content_sb");K.textContent=e.getMessage("Zip");k.appendChild(K);k.appendChild(x);x.appendChild(y);x.appendChild(r.elem);var r=g("div","section","utils","utils","sb"),y=g("div","section_head","utils","utils","head_sb"),K=g("div","section_content","utils","utils","content_sb"),B=p.createDropDown(e.getMessage("Type"),{id:"cloud_type",value:"edge"==z.RUNTIME.BROWSER?"onedrive":"drive"},
[{name:"Google Drive",value:"drive"},"safari"==z.RUNTIME.BROWSER?null:{name:"Dropbox",value:"dropbox"},{name:"OneDrive",value:"onedrive"}].filter(function(a){return a}),function(){});y.textContent=e.getMessage("Cloud");r.appendChild(y);r.appendChild(K);K.appendChild(B.elem);K.appendChild(G);K.appendChild(E);E=g("div","section","utils","utils","fi");G=g("div","section_head","utils","utils","head_fi");y=g("div","section_content","utils","utils","content_fi");G.textContent=e.getMessage("File");E.appendChild(G);
E.appendChild(y);y.appendChild(A);y.appendChild(n.elem);var C=g("input","updateurl_input","utils","utils","url");C.setAttribute("type","text");C.setAttribute("spellcheck","false");n=g("div","section","utils","utils","ur");A=g("div","section_head","utils","utils","head_ur");G=g("div","section_content","utils","utils","content_ur");A.textContent=e.getMessage("URL");n.appendChild(A);n.appendChild(G);G.appendChild(C);G.appendChild(b);a.appendChild(pa);"undefined"!==typeof Blob&&a.appendChild(r);z.RUNTIME.CAN_SAVEAS_ZIP&&
a.appendChild(k);"undefined"!==typeof Blob&&a.appendChild(E);a.appendChild(ca);a.appendChild(n);v.each([ca],function(a){var b=a.getAttribute("class"),b=50>t.configMode?b+" hide":b.replace(" hide","");a.setAttribute("class",b)});d.appendChild(a)},xb=function(){var a=document.getElementById("options"),b=g("div","content_wrapper","options","main");if(a){var c=a.parentNode;c.removeChild(a);c.appendChild(b);$(document.body).addClass("main")}var a=g("div","head_container","opt","head_container"),c=g("div",
"tv_container_fit","opt","tv_container"),d=w("a","head_link","heads","head_link");d.href="http://tampermonkey.net";d.target="_blank";var e=g("div","float","heads","head1"),f=g("img","banner","heads");f.src=rea.extension.getURL("images/icon128.png");var l=g("div","float head","heads","head2"),m=g("div","header_title","heads"),k=g("div","version","version","version");k.textContent=" by Jan Biniok";var r=w("div","search","box",""),n=g("div","footer","footer");m.innerHTML="Tampermonkey<sup>\u00ae</sup>";
e.appendChild(f);l.appendChild(m);l.appendChild(k);d.appendChild(e);d.appendChild(l);a.appendChild(d);a.appendChild(r);b.appendChild(a);b.appendChild(c);I=Oa.create("_main",c);I.setFooter(n);H.unshift(function(){wb(I);tb(I)});H.push(function(){void 0!==X.contribute&&window.setTimeout(function(){Xa("f")},100);ta.global=!0})},V=function(a,b,c,d){void 0===d&&(d={});var h=b.item,f=h.uuid+(d.orig||"")+b.id,l=(d.orig?"orig_":"use_")+b.id,m=function(a){return"select_"+v.createUniqueId(a,h.uuid)+"_sel1"},
k=g("div","cludes",a,f,"cb1"),r=w("span",a,f,"cb2");if(d.orig){var n="merge_"+b.id,n=p.createCheckbox(a,{id:n,uuid:h.uuid,enabled:h.options&&h.options.override&&h.options.override[n]?!0:!1},function(){if("checkbox"==this.type){var a={};a[this.key]=this.checked;ia(this.uuid,a)}});r.appendChild(n.elem)}else r.textContent=a;var E=g("select","cludes",l,h.uuid,"sel1");E.innerHTML="";E.setAttribute("size","6");E.setAttribute("multiple","true");for(l=0;l<c.length;l++)n=document.createElement("option"),n.value=
n.text=c[l],E.appendChild(n);k.appendChild(r);h.desc&&p.setHelp(h.desc,k,r,h);k.appendChild(E);var K=function(a){var b=[];a=a&&a.options;for(var c=0,d=a.length;c<d;c++)a[c].selected&&b.push(a[c]);return b},l=function(){var a=m("use_"+("excludes"==b.id?"includes":"excludes")),c=document.getElementById(a),a=K(E),d=!1,e="matches"==b.id;a.forEach(function(a){var b=e?"/"+Aa.getRegExpFromMatch(a.value)+"/":a.value;a&&!c.querySelector('option[value="'+b+'"]')&&(a=a.cloneNode(!0),e&&(a.value=b,a.textContent=
b),c.appendChild(a),d=!0)});d&&y()},n=function(){var a=prompt(e.getMessage("Enter_the_new_rule"));if(a){var b=document.createElement("option");b.value=b.text=a.trim();E.appendChild(b);y()}},r=function(){var a=E.options[E.selectedIndex];if(a){var b=prompt(e.getMessage("Enter_the_new_rule"),a.value);b&&(a.value=a.text=b.trim(),y())}};c=function(){var a=!1;K(E).forEach(function(b){b&&(b.parentNode.removeChild(b),a=!0)});a&&y()};var A=function(a){for(var b=[],c=0;c<a.options.length;c++)b.push(a.options[c].value);
return b},y=function(){var a={includes:A(document.getElementById(m("use_includes"))),matches:A(document.getElementById(m("use_matches"))),excludes:A(document.getElementById(m("use_excludes"))),connects:A(document.getElementById(m("use_connects"))),temp_connects:A(document.getElementById(m("use_temp_connects"))),blockers:A(document.getElementById(m("use_blockers")))};ia(h.uuid,a);return!0};d.other_name?(a=w("button",a,f,"btn1",!0),a.textContent=e.getMessage("Add_as_0clude0",d.other_name),a.addEventListener("click",
l,!1),k.appendChild(a)):d.orig||(d=w("button",a,f,"btn2",!0),d.textContent=e.getMessage("Add")+"...",d.addEventListener("click",n,!1),k.appendChild(d),d=w("button",a,f,"btn3",!0),d.textContent=e.getMessage("Edit")+"...",d.addEventListener("click",r,!1),k.appendChild(d),a=w("button",a,f,"btn4",!0),a.textContent=e.getMessage("Remove"),a.addEventListener("click",c,!1),k.appendChild(a));return{elem:k}},Ja=function(a){return a.homepage?a.homepage:a.namespace&&0==a.namespace.search(/https?:\/\//)?a.namespace:
null};Da.create("sites").setOptions({timeout:600,check_interval:300,retimeout_on_get:!0}).init();var Ha=function(){var a={},b=function(a){return 7>a.toString().length?b("0"+a):a},c=function(a){if(a.includes||a.matches){for(var b={},c=[],e=a.includes.length?a.includes:a.matches,g=0;g<e.length;g++){var k=e[g];if(k){var r=Da.items.sites.get(k),n=void 0!==r?r:p.getInfoFromUrl(k);void 0===r&&Da.items.sites.set(k,n);n&&n.dom?b[n.dom]||(b[n.dom]=!0,c.push({include:k,info:n})):c.push({include:k})}else console.log("o: Warn: script '"+
a.name+"' has invalid include (index: "+g+")")}return c}};return{init:function(b){a={};b.forEach(function(b){(b=c(b))&&b.length&&b.forEach(function(b){b.info&&(a[b.info.dom]=(a[b.info.dom]||0)+1)})})},get:function(d){d=c(d);if(!d||!d.length)return b(0);d=v.map(d,function(b){return b.info?{score:1E3*a[b.info.dom]+b.info.dom.charCodeAt(0)||0,dom:b.info.dom}:{score:0,dom:""}}).sort(function(a,b){return b.score-a.score})[0];return b(d.score)+d.dom},topIcons:function(b,e){var f,l=[],m=c(b);if(!m||!m.length)return[];
m=v.map(m,function(b){b.score=b.info?a[b.info.dom]||0:0;return b}).sort(function(a,b){return b.score-a.score});v.each(m,function(a){var c=a.info;if(0==e--)return a=g("span","",b.uuid,"tbc"),a.textContent="...",l.push(a),!1;if(c){if("*"==c.tld)return f=p.createIcon(C.get("web"),"web",b.uuid,a.include,a.include),l.push(f),!1;var n="com",m="";"*"!=c.tld&&"tld"!=c.tld&&(n=c.tld);c.subdom.length&&(m=c.subdom.join(".")+".");n=(m+c.dom+"."+n).replace(/\*/g,"");m="http://"+n+"/";c=z.RUNTIME.CHROME?"chrome://favicon/"+
m:null;n=0==m.search("http://userscripts.org/")||0==m.search("http://userscripts.com/")?C.origin("uso"):"native"==t.favicon_service?m+"favicon.ico":"duckduckgo"==t.favicon_service?"https://icons.duckduckgo.com/ip2/"+encodeURIComponent(n)+".ico":"https://www.google.com/s2/favicons?domain="+encodeURIComponent(n);f=p.createFavicon([n,c,function(){return C.get("question_mark")}].filter(function(a){return a}),"favicon",b.uuid,a.include,a.include)}else f=p.createIcon(C.get("question_mark"),"favicon",b.uuid,
a.include,a.include);l.push(f)});return l}}}(),da=function(){if(z.HTML5.LOCALSTORAGE)return z.HTML5.LOCALSTORAGE.getItem("sort_key")},ha=function(){if(z.HTML5.LOCALSTORAGE)return z.HTML5.LOCALSTORAGE.getItem("sort_sequence")},Ta=function(a){if(z.HTML5.LOCALSTORAGE)return z.HTML5.LOCALSTORAGE.setItem("sort_key",a)},Sa=function(a){if(z.HTML5.LOCALSTORAGE)return z.HTML5.LOCALSTORAGE.setItem("sort_sequence",a)},Ua=function(a){var b=function(a,c){return a.tagName==c?a:a.parentNode?b(a.parentNode,c):null},
c="down"==ha(),d=null,h=[],f=0,l=Date.now();Object.keys(U).forEach(function(a){var c=U[a];if(c)if(a=b(c.dom,"TR")){var n=b(a,"TBODY");d?n&&d!=n&&console.warn("options: different parents?!?!"):d=n;f++;var g,m;if(!(g=c.script.lastModified||c.script.lastUpdated)||(m=l-parseInt(g))&&isNaN(m))m=0;g=parseInt(c.script.version);isNaN(g)&&(g=0);h.push({tr:a,sites:Ha.get(c.script),enabled:c.script.enabled,position:c.script.position?c.script.position:1E3+f,name:e.getTranslation(c.script,"name").toLowerCase(),
homepage:[c.script.origin?Aa.parse(c.script.origin.url).hostname:"z",Ja(c.script)?Aa.parse(Ja(c.script)).hostname:"z"].join("_"),updated:m,version:g});a.inserted=!1;a.parentNode&&a.parentNode.removeChild(a)}else console.log("options: unable to sort script at pos "+c.pos);else console.warn("options: something went wrong!",a)});h=function(a){var b;b=function(a){return function(b,c){return b[a]-c[a]}};var d=function(a){return function(b,c){return b[a]<c[a]?-1:b[a]>c[a]?1:0}},e=function(a,b){return function(c,
d){var e=(b^c[a]?"a":"b")+c.name,h=(b^d[a]?"a":"b")+d.name;return e<h?-1:e>h?1:0}},h=da();"pos"==h?b=b("position"):"enabled"==h?(b=e("enabled",c),c=null):b="ver"==h?b("version"):"updated"==h?b("updated"):d(h);a.sort(b);return a}(h);c&&(h=h.reverse());for(var g=0;g<f;g++)d.appendChild(h[g].tr);$(".sorting").each(function(a,b){var c=$(b),d="pos"==da()&&"up"==ha();c[d?"fadeIn":"fadeOut"]()});a&&a()},Bb=function(a,b,c,d,h){c=w("div",b.uuid,"script_tab_head");var f=c.inserted,l=g("table","noborder p100100 heading",
b.uuid,"h_table"),m=g("tr","",b.uuid,"h_tr1"),k=g("td","nameNicon64",b.uuid,"h_td1"),r=g("td","",b.uuid,"h_td2");l.appendChild(m);m.appendChild(k);m.appendChild(r);r.setAttribute("style","width: 99%");var m=w("img",b.uuid,"heading_icon"),n=b.icon64?b.icon64:b.icon;m.src=n;var E=g("div","nameNname64",b.uuid,"heading_name");E.textContent=e.getTranslation(b,"name");n&&k.appendChild(m);r.appendChild(E);k=g("div","author",b.uuid,"author");b.author?k.textContent="by "+b.author:b.copyright&&(k.innerHTML=
"&copy; ",k.textContent+=b.copyright);r.appendChild(k);r=g("table","noborder p100100",b.uuid,"table");k=g("tr","script_tab_head",b.uuid,"tr1");m=g("tr","details",b.uuid,"tr2");n=g("td","",b.uuid,"td1");E=g("td","",b.uuid,"td2");c.appendChild(l);n.appendChild(c);k.appendChild(n);m.appendChild(E);r.appendChild(k);r.appendChild(m);d.appendChild(r);var p=Oa.create("_details"+b.uuid,E,{tv:"tv tv_alt",tv_table:"tv_table tv_table_alt",tr_tabs:"tr_tabs tr_tabs_alt",tr_content:"tr_content tr_content_alt",
td_content:"td_content td_content_alt",td_tabs:"td_tabs td_tabs_alt",tv_tabs_align:"tv_tabs_align tv_tabs_align_alt",tv_tabs_fill:"tv_tabs_fill tv_tabs_fill_alt",tv_tabs_table:"tv_tabs_table tv_tabs_table_alt",tv_contents:"tv_contents tv_contents_alt",tv_tab_selected:"tv_tab tv_selected tv_tab_alt tv_selected_alt",tv_tab_close:"tv_tab_close",tv_tab:"tv_tab tv_tab_alt",tv_content:"tv_content tv_content_alt"},!0),A=Ya(b,p,{do_close:h,set_tab_class:function(b,c){a.toggleClass(b,c)},navid:"editor",treeid:"source"}),
y=b.nnew||b.system?{}:yb(b,p),G=b.nnew||b.system||!b.storage_key_count||80>t.configMode?{}:zb(b,p),q=b.nnew||b.system||!b.requires.length&&!b.resources.length?{}:Ab(b,p);if(f)return W["tab"+b.uuid];var x=function(){var a;return(a=p.getSelectedTab())&&a.isCloseable()?q.getEditor():A.getEditor()},u=function(b){var c=!1;if("keydown"==b.type&&a.isSelected()&&!b.defaultPrevented){if(27==b.keyCode){if(!t.editor_enabled||"vim"!=t.editor_keyMap){var d;(d=p.getSelectedTab())&&d.isCloseable()?d.close():window.setTimeout(h,
1);c=!0}}else if(t.editor_enabled){var e={save:!0,find:!0,findNext:!0,findPrev:!0,replace:!0,replaceAll:!0},k=x();d=CodeMirror.keyName(b);k&&!k.hasFocus()&&"handled"==CodeMirror.lookupKey(d,k.getOption("keyMap"),function(a){if(e[a])return k.execCommand(a),!0})&&(c=!0)}else 83==b.keyCode&&(b.ctrlKey||b.metaKey)&&(d=x())&&(d.save(),c=!0);if(c)return b.stopPropagation(),b.preventDefault(),!1}};d={onShow:function(){v.each([y,A,G,q],function(a){if(a.onShow)a.onShow()});window.addEventListener("keydown",
u,!1)},onClose:function(a){var b;v.each([y,A,G,q],function(c){if(c.onClose&&c.onClose(a))return b=!0,!1});b||window.removeEventListener("keydown",u,!1);return b},afterSelect:function(){if(b.uuid){var a=M.get().sub,c=p.getTabById(a);M.set(b.uuid,(c?a:null)||"editor");document.title=e.getTranslation(b,"name")}v.each([y,A,q],function(a){a.afterSelect&&a.afterSelect()})}};return W["tab"+b.uuid]=d},yb=function(a,b){var c=w("div",a.uuid,"script_setting_h"),d=w("div",a.uuid,"script_settings_c");c.textContent=
e.getMessage("Settings");var h,f=function(){if("checkbox"==this.type||"button"==this.type)h={},h[this.key]=!this.oldvalue,ia(this.uuid,h);else if("text"==this.type||"textarea"==this.type||"select-one"==this.type){var a=p.getValue(this);h={};h[this.key]=a;ia(this.uuid,h)}},l=p.createPosition(e.getMessage("Position_")+": ",{id:"position",uuid:a.uuid,name:"pos",pos:a.position,posof:a.positionof},f),m=p.createDropDown(e.getMessage("Run_at"),{id:"run_at",uuid:a.uuid,name:"run-at",value:a.run_at},[{name:"document-start",
value:"document-start"},{name:"document-body",value:"document-body"},{name:"document-end",value:"document-end"},{name:"document-idle",value:"document-idle"},{name:"context-menu",value:"context-menu"},{name:e.getMessage("Default"),value:null}],f),k=p.createDropDown(e.getMessage("No_frames"),{id:"noframes",uuid:a.uuid,name:"no_frames",value:a.noframes},[{name:e.getMessage("Yes"),value:!0},{name:e.getMessage("No"),value:!1},{name:e.getMessage("Default"),value:null}],f),r=p.createCheckbox(e.getMessage("Check_for_Updates"),
{id:"check_for_updates",uuid:a.uuid,name:"upd",enabled:a.check_for_updates},f),n=function(b){return(a.options&&a.options.override?a.options.override[b]:null)||[]},E=V(e.getMessage("Original_includes"),{id:"includes",item:a},n("orig_includes"),{orig:!0,other_name:e.getMessage("User_excludes")}),q=V(e.getMessage("Original_matches"),{id:"matches",item:a},n("orig_matches"),{orig:!0,other_name:e.getMessage("User_excludes")}),A=V(e.getMessage("Original_excludes"),{id:"excludes",item:a},n("orig_excludes"),
{orig:!0,other_name:e.getMessage("User_includes")}),y=g("div","clear",a.uuid,"clear"),G=V(e.getMessage("User_includes"),{id:"includes",item:a},n("use_includes")),t=V(e.getMessage("User_matches"),{id:"matches",item:a},n("use_matches")),x=V(e.getMessage("User_excludes"),{id:"excludes",item:a},n("use_excludes")),u=V(e.getMessage("Original_domain_whitelist"),{id:"connects",item:a},a.connects,{orig:!0}),v=V(e.getMessage("Temporary_domain_whitelist"),{id:"temp_connects",item:a},a.temp_connects),C=V(e.getMessage("User_domain_whitelist"),
{id:"connects",item:a},n("use_connects")),n=V(e.getMessage("User_domain_blacklist"),{id:"blockers",item:a},n("use_blockers")),F=p.createCheckbox(e.getMessage("Apply_compatibility_options_to_required_script_too"),{id:"compatopts_for_requires",uuid:a.uuid,name:"",enabled:a.compatopts_for_requires},f),B=p.createCheckbox(e.getMessage("Fix_wrappedJSObject_property_access"),{id:"compat_wrappedjsobject",uuid:a.uuid,name:"",enabled:a.compat_wrappedjsobject},f),z=p.createCheckbox(e.getMessage("Convert_CDATA_sections_into_a_chrome_compatible_format"),
{id:"compat_metadata",uuid:a.uuid,name:"",enabled:a.compat_metadata},f),D=p.createCheckbox(e.getMessage("Replace_for_each_statements"),{id:"compat_foreach",uuid:a.uuid,name:"",enabled:a.compat_foreach},f),N=p.createCheckbox(e.getMessage("Fix_for_var_in_statements"),{id:"compat_forvarin",uuid:a.uuid,name:"",enabled:a.compat_forvarin},f),Y=p.createCheckbox(e.getMessage("Convert_Array_Assignements"),{id:"compat_arrayleft",uuid:a.uuid,name:"",enabled:a.compat_arrayleft},f),T=p.createCheckbox(e.getMessage("Add_toSource_function_to_Object_Prototype"),
{id:"compat_prototypes",uuid:a.uuid,name:"",enabled:a.compat_prototypes},f),Z=[F,B,z,D,N,Y,T],F=g("div","section",a.uuid,"ta_opt"),z=g("div","section_head",a.uuid,"head_ta_opt"),B=g("div","section_content",a.uuid,"content_ta_opt");z.textContent=e.getMessage("Settings");F.appendChild(z);F.appendChild(B);z=g("div","section",a.uuid,"ta_upd");N=g("div","section_head",a.uuid,"head_ta_upd");D=g("div","section_content",a.uuid,"content_ta_upd");N.textContent=e.getMessage("Updates");z.appendChild(N);z.appendChild(D);
N=g("div","section",a.uuid,"ta_cludes");T=g("div","section_head",a.uuid,"head_ta_cludes");Y=g("div","section_content",a.uuid,"content_ta_cludes");T.textContent=e.getMessage("Includes_Excludes");N.appendChild(T);N.appendChild(Y);var T=g("div","section",a.uuid,"ta_security"),ba=g("div","section_head",a.uuid,"head_ta_security"),H=g("div","section_content",a.uuid,"content_ta_security");ba.textContent=e.getMessage("XHR_Security");T.appendChild(ba);T.appendChild(H);var ba=g("div","section",a.uuid,"ta_compat"),
P=g("div","section_head",a.uuid,"head_ta_compat"),Ra=g("div","section_content",a.uuid,"content_ta_compat");P.textContent=e.getMessage("GM_compat_options_");ba.appendChild(P);ba.appendChild(Ra);B.appendChild(l);B.appendChild(m.elem);B.appendChild(k.elem);D.appendChild(r.elem);Y.appendChild([E.elem,q.elem,A.elem,y,G.elem,t.elem,x.elem]);H.appendChild([u.elem,v.elem,C.elem,n.elem]);d.appendChild([F,z,N,T]);for(l=0;l<Z.length;l++)Ra.appendChild(Z[l].elem);a.awareOfChrome&&Object.keys(Z).forEach(function(a){Z[a].input.setAttribute("disabled",
"disabled");Z[a].elem.setAttribute("title",e.getMessage("This_script_runs_in_Chrome_mode"))});d.appendChild(ba);var Ka=p.createTextarea(null,{name:"",uuid:a.uuid,id:"comment",value:a.options.comment});Ka.elem.setAttribute("class","script_setting_wrapper");l=w("div",a.uuid,"save");m=p.createButton("save_button",a.uuid,e.getMessage("Save"),function(){f.apply(Ka.textarea,[])});l.appendChild(m);m=g("div","section",a.uuid,"ta_comment");k=g("div","section_head",a.uuid,"head_ta_comment");r=g("div","section_content",
a.uuid,"content_ta_comment");k.textContent=e.getMessage("Comment");m.appendChild(k);m.appendChild(r);r.appendChild(Ka.elem);r.appendChild(l);d.appendChild(m);l=g("div","section",a.uuid,"ta_det");m=g("div","section_head",a.uuid,"head_ta_det");k=g("div","section_content",a.uuid,"content_ta_det");m.textContent=e.getMessage("Details");l.appendChild(m);l.appendChild(k);m.textContent=e.getMessage("Details");var Za=g("table","script_details",a.uuid,"script_details");[{label:e.getMessage("Size"),value:ma.formatBytes((a.code?
a.code:a).length,2)},{label:e.getMessage("UUID"),value:a.uuid}].forEach(function(b){var c=g("tr","external_desc",a.uuid,b.label,"tr"),d=g("td","external_desc",a.uuid,b.label,"td1"),e=g("td","",a.uuid,b.label,"td2");d.textContent=b.label;e.textContent=b.value;c.appendChild(d);c.appendChild(e);Za.appendChild(c)});k.appendChild(Za);d.appendChild(l);var Cb=b.appendTab("settings",c,d,function(){M.setSub("settings")});M.registerListener(a.uuid,"settings",function(){Cb.select()});return{}},$a=function(a,
b,c,d){var h=g("table","externals",a.uuid,"outer_req2html",b,!0),f=0,l=[{label:e.getMessage("URL"),prop:"display_url"},{label:e.getMessage("Size"),prop:"data",fn:function(a){var b="?";a&&(void 0!==a.length?b=a.length:void 0!==a.content&&(b=a.content.length));return ma.formatBytes(b,2)}},{label:e.getMessage("MIME_Type"),prop:"mimetype"},{label:e.getMessage("Subresource_Integrity"),prop:"sri",fn:function(a){return a?a.type+"="+a.value:e.getMessage("_not_set_")}},{label:e.getMessage("Last_updated"),
prop:"ts",fn:function(a){return a?(new Date(a)).toString():null}}];l.push({label:e.getMessage("User_modified"),prop:"modified",klass:"validation",title:e.getMessage("This_external_resource_will_not_auto_update__Please_delete_it_in_order_to_enable_updates_again_"),icon:C.get("info"),fn:function(a){return a?e.getMessage("Yes"):null}});a[b].forEach(function(k){var n=f+v.createUniqueId(k.url)+b;l.forEach(function(b){var c,d=g("tr","",a.uuid,b.prop,"tr"+n),e=g("td","external_label",a.uuid,b.prop,"td1"+
n),f=g("td","external_desc",a.uuid,b.prop,"td2"+n);e.textContent=b.label;f.textContent=c=(b.fn?b.fn:function(a){return a})(k[b.prop]);null!==c&&(b.klass&&$(f).addClass(b.klass),b.title&&f.setAttribute("title",b.title),b.icon&&(c=g("span","validation",a.uuid,"validation","span"+n),c.appendChild(p.createIcon(b.icon+" red","warning",a.uuid,n+"no_require_update_warning")),f.appendChild(c)),d.appendChild(e),d.appendChild(f),h.appendChild(d))});var m=g("tr","external_desc_buttons",a.uuid,k.url,"tr"+n),
q=g("td","",a.uuid,"buttons","td"+n);m.appendChild(q);h.appendChild(m);if(k.ts){if("requires"==b||k.editable){var m=w("span",a.uuid,"edit_external"+n),A=p.createImageTextButton(a.uuid,"edit_external"+n,e.getMessage("Edit"),"edit",function(){Db(c,a.uuid,k,d)});m.appendChild(A);q.appendChild(m)}var m=w("span",a.uuid,"delete_external"+n),y=p.createImageTextButton(a.uuid,"delete_external"+n,e.getMessage("Delete"),"delete",function(){Eb(a.uuid,k.url);y.parentNode&&y.parentNode.removeChild(y)});m.appendChild(y);
q.appendChild(m)}f++});if(!f){var m=g("tr","script_desc",a.uuid,f,"tr"),k=g("td","script_desc",a.uuid,f,"td1");k.textContent=e.getMessage("No_entry_found");m.appendChild(k);h.appendChild(m)}return h},Db=function(a,b,c,d){var h="externals-"+b+"-"+c.url;u[h]={};var f=Fb({uuid:h,script_uuid:b,mimetype:c.mimetype,name:e.getMessage("Externals")+" - "+c.url,file_url:c.url,referrer:"options.scripts.userscripts"},a,function(){d(f.getEditor())},function(){delete W["tab"+h];delete W["editor"+h];delete u[h]});
f.show()},Ab=function(a,b){var c,d=function(a){c=a},h=w("div","",a.uuid,"script_external_h");h.textContent=e.getMessage("Externals");var f=w("div","",a.uuid,"script_externals_c"),l=g("div","section",a.uuid,"ta_requires"),m=g("div","section_head",a.uuid,"head_ta_requires"),k=g("div","section_content",a.uuid,"content_ta_requires");m.textContent=e.getMessage("Requires");l.appendChild(m);l.appendChild(k);k.appendChild($a(a,"requires",b,d));var m=g("div","section",a.uuid,"ta_resources"),k=g("div","section_head",
a.uuid,"head_ta_resources"),r=g("div","section_content",a.uuid,"content_ta_resources");k.textContent=e.getMessage("Resources");m.appendChild(k);m.appendChild(r);r.appendChild($a(a,"resources",b,d));f.appendChild(l);f.appendChild(m);var n=b.appendTab("externals",h,f,function(){M.setSub("externals")});M.registerListener(a.uuid,"externals",function(){n.select()});return{getEditor:function(){return c}}},zb=function(a,b){var c=function(a,b){if("string"===typeof a){var c=a[0];a=a.substr(1);switch(c){case "b":return"true"===
a;case "n":return Number(a);case "o":try{return JSON.parse(a)}catch(d){console.log("values: parseValueFromStorage: "+d)}return b;default:return a}}else return b},d=w("div","",a.uuid,"script_storage_h");d.textContent=e.getMessage("Storage");var h=w("div","",a.uuid,"script_storages_c"),f=g("div","section",a.uuid,"ta_storage"),l=g("div","section_head",a.uuid,"head_ta_storage"),m=g("div","section_content",a.uuid,"content_ta_storage");l.textContent=e.getMessage("Storage");f.appendChild(l);f.appendChild(m);
var k=g("textarea","storageta",a.uuid,"storage");k.setAttribute("wrap","off");k.setAttribute("wrap","off");k.setAttribute("spellcheck","false");l=p.createButton("storage_save_button",a.uuid,e.getMessage("Save"),function(){var b=null;try{b=JSON.parse(k.value)}catch(c){v.alert(e.getMessage("Unable_to_parse_this_"));return}var d=Object.keys(b),h=Object.keys(a.storage);d.concat(h).filter(function(a,b,c){return c.lastIndexOf(a)===b}).forEach(function(c){if(-1==d.indexOf(c))ab(a.uuid,c);else if(-1==h.indexOf(c)||
b[c]!==a.storage[c]){var e=ab,k=a.uuid,f;a:{f=b[c];var l=(typeof f)[0];switch(l){case "o":try{f=l+JSON.stringify(f)}catch(g){console.log(g);f=void 0;break a}break;default:f=l+f}}e(k,c,f)}})});m.appendChild(k);m.appendChild(l);h.appendChild(f);var r=b.appendTab("storage",d,h,function(){M.setSub("storage")});M.registerListener(a.uuid,"storage",function(){(function(){if(a.referrer&&void 0===a.storage){var b=D();qa({referrer:a.referrer+".storage",uuid:a.uuid},function(a){if(a.items){var d={},e=a.items[0];
Object.keys(e).forEach(function(a){d[a]=c(e[a])});b.resolve(d)}else b.reject();q.hide()});return b.promise()}return D.Pledge(a.storage)})().done(function(b){k.value=k.value||JSON.stringify(b,null,4);a.storage=b;k.removeAttribute("disabled")}).fail(function(){k.setAttribute("disabled",!0)});r.select()});return{}},bb=function(a){return a.replace("<$URL$>",X.url?kb.Base64.decode(X.url):"http://*/*")},Fb=function(a,b,c,d){var e;a.is_external=!0;var f=function(){e&&!l.onClose()&&(d(),e&&e.remove(),e=null)},
l=Ya(a,b,{tab_name:a.name,navid:a.uuid,treeid:"external",mimetype:a.mimetype,tree_opts:{url:a.file_url,uuid:a.script_uuid},do_close:function(){window.setTimeout(f,100)},on_tab_close:f,on_tab_select:c,on_editor_load:c});e=l.getTab();l.show=function(){l.onShow();e.select()};return l},Ya=function(a,b,c){var d=g("tr","editor_container p100100",a.uuid,"container"),h=c.mimetype||"text/javascript",f=!h||/(application|text)\/(?:x-)?(?:java|ecma)script/.test(h);if(!a.nnew&&P(a.uuid,"lastI"))return W["editor"+
a.uuid]||{};a.nnew&&(a.code=bb(t.script_templates[0].value));var l=w("div",a.uuid,"script_editor_h"),m=l.inserted,k=w("div",a.uuid,"script_editor_c"),r=g("tr","editormenubar",a.uuid,"container_menu"),n=g("table","editor_container_o p100100 noborder",a.uuid,"container_o");n.appendChild(r);n.appendChild(d);k.appendChild(n);var E=function(){var b=!1;d.editor&&(b=t.editor_enabled?b|(d.editor.changed&&d.editor.mirror.historySize().undo):d.editor.value!=a.code);return b},K=function(){CodeMirror.commands.trimTrailingSpacesIfEnabled(d.editor.mirror);
P(a.uuid,"saveEm")},A=function(a,b,d){c.do_close&&c.do_close(b,d)},y=function(a){d.editor.changed!=a&&(c.set_tab_class&&c.set_tab_class("modified",a),Y.toggleClass("modified",a));d.editor.changed=a},n=p.createImageButton(a.uuid,"save_to_disk",e.getMessage("Save_to_disk"),C.get("save_to_disk"),function(){P(a.uuid,"saveToDisk")}),G=p.createImageButton(a.uuid,"save",e.getMessage("Save"),C.get("filesave"),K),z=p.createImageButton(a.uuid,"cancel",e.getMessage("Editor_reset"),C.get("editor_cancel"),function(){confirm(e.getMessage("Really_reset_all_changes_"))&&
d.editor&&(t.editor_enabled?(d.editor.mirror.setValue(a.code),y(!1)):d.editor.value=a.code)}),x=p.createImageButton(a.uuid,"reset",e.getMessage("Full_reset"),C.get("script_cancel"),function(){confirm(e.getMessage("Really_factory_reset_this_script_"))&&u[a.uuid].fullReset(function(a){a.cleaned&&A(null,!0,!1)})}),H=p.createImageButton(a.uuid,"close_script",e.getMessage("Close"),C.get("exit"),A),pa=p.createImageButton(a.uuid,"lint_script",e.getMessage("Run_syntax_check"),C.get("check"),function(){window.setTimeout(function(){var a;
t.editor_enabled&&(a=d.editor)&&(q.wait(),window.setTimeout(function(){a.mirror.performLint(!0);var b=window.JSHINT.errors;if(b&&b.length){1===b.length?cb(e.getMessage("One_error_or_hint_was_found_")):cb(e.getMessage("0count0_errors_or_hints_were_found_",b.length));for(var c,d=0;c=b[d];d++)if(1<c.line){a.mirror.setCursor(c.line-1,c.character-1);a.mirror.focus();break}}else db(e.getMessage("No_syntax_errors_were_found_"));q.hide()},100))},1)}),Q;a.nnew&&(Q=p.createDropDown(null,{value:t.script_templates[0].name,
uuid:"template-select",name:"template-select"},t.script_templates.map(function(a){return{name:a.name,value:a.name}}),function(){var a=this;if(E()&&!confirm(e.getMessage("Really_reset_all_changes_")))a.value=a.oldvalue;else{var b=null;t.script_templates.map(function(c){c.name===a.value&&(b=bb(c.value))});b?(this.oldvalue=a.value,d.editor&&(t.editor_enabled?(d.editor.mirror.setValue(b),y(!1)):d.editor.value=b)):a.value=a.oldvalue}}));var F=p.createInput(e.getMessage("Update_URL_"),{id:"file_url",uuid:a.uuid,
name:"uu",value:a.file_url});F.input.setAttribute("class","updateurl_input");F.elem.setAttribute("class","updateurl");a.is_external&&F.input.setAttribute("readonly","true");var B=g("textarea","editorta",a.uuid,"editor");B.setAttribute("wrap","off");B.setAttribute("spellcheck","false");var I=g("td","editor_outer",a.uuid,"edit"),L=g("div","editor_100 editor_border",a.uuid,"edit"),N=g("div","editormenu",a.uuid,"editormenu");I.appendChild(L);r.appendChild(N);r.appendChild(F.elem);d.inserted||(L.appendChild(B),
d.appendChild(I));u[a.uuid].saveToDisk=function(){if(d.editor){var b=t.editor_enabled?d.editor.mirror.getValue():d.editor.value;q.wait();return ra().done(function(){var c=new Blob([b],{type:"text/plain"});saveAs(c,v.safeFileName(a.name+(a.is_external?"":".user.js")))}).always(function(){q.hide()})}};a.system||(u[a.uuid].saveEm=a.is_external?function(b){if(d.editor){var c=t.editor_enabled?d.editor.mirror.getValue():d.editor.value;Gb(a.script_uuid,c,{url:a.file_url,mimetype:a.mimetype,auto_save:b&&
b.auto_save}).done(function(a){a.success?y(!1):a.aborted||b&&b.auto_save||(a.messages&&a.messages.errors&&a.messages.errors.length?v.alert(a.messages.errors.join("\n")):v.alert(e.getMessage("Unable_to_parse_this_")))})}}:function(b){if(d.editor){var c=!0;t.showFixedSrc&&(c=confirm(e.getMessage("Do_you_really_want_to_store_fixed_code_",e.getMessage("Show_fixed_source"))));var h=t.editor_enabled?d.editor.mirror.getValue():d.editor.value;c&&La(a.uuid,h,{old_url:F.input?F.input.oldvalue:"",new_url:F.input?
F.input.value:"",clean:!1,new_script:a.nnew,auto_save:b&&b.auto_save,reload:!0,lastModTime:u[a.uuid].saveEm_lastModTime}).done(function(c){c.installed?a.nnew?A(null,!0,!1):(y(!1),c.lastModified&&(a.lastModTime=c.lastModified)):c.aborted||b&&b.auto_save||(c.messages&&c.messages.errors&&c.messages.errors.length?v.alert(c.messages.errors.join("\n")):v.alert(e.getMessage("Unable_to_parse_this_")))});return c}},N.appendChild(n),N.appendChild(G),N.appendChild(z));a.nnew||a.is_external||N.appendChild(x);
N.appendChild(H);!a.system&&t.editor_enabled&&f&&N.appendChild(pa);a.nnew&&N.appendChild(Q.elem);var Y=b.insertTab(null,c.navid,l,k,function(){M.setSub(c.navid);if(c.on_tab_select)c.on_tab_select()},c.on_tab_close);Y.setHeading(c.tab_name||e.getMessage("Editor"),50);M.registerListener(a.uuid,c.navid,function(){Y.select();t.editor_enabled&&d.editor&&(d.editor.refresh(),d.editor.mirror.focus())});if(m)return W["editor"+a.uuid];var T,Z,ba=function(a,b,c,d){a=d.getValue();if(a.length<t.editor_autoLintMaxLen){if(!Z){var e=
d.getHelper(CodeMirror.Pos(0,0),"lint");Z=window.setTimeout(function(){Z=null;T=!0;var h=e(a,c,d);b(h)},1)}}else T&&(b([]),T=!1)},O=function(a){ua("editor_theme",a,!0).done(function(){db("Theme switched to "+a)})},J=function(){t.editor_autoSave&&E()&&P(a.uuid,"saveEm",{auto_save:!0})};b={getTab:function(){return Y},getEditor:function(){if(d.editor)return t.editor_enabled?d.editor.mirror:{save:K}},onShow:function(){(function(){if(a.referrer&&void 0===a.code){var b=D();qa(v.copy(c.tree_opts||{},{referrer:a.referrer+
"."+c.treeid,uuid:a.uuid}),function(c){c.items?(a.code=c.items[0],b.resolve()):b.reject();q.hide()});return b.promise()}return D.Pledge()})().done(function(){var b=k.getElementsByTagName("textarea");u[a.uuid].lastI=function(){return a};if(b.length&&!d.editor){var b=b[0],l=function(){d.editor&&y(!!d.editor.mirror.historySize().undo)};if(t.editor_enabled){var g=b.parentNode;g.removeChild(b);d.editor=new MirrorFrame(g,{mode:h,theme:t.editor_theme,fontSize:t.editor_fontSize,themeOptions:{all:Ca.getEditorThemes().map(function(a){return a.value}),
onChange:O},value:a.code,indentUnit:Number(t.editor_indentUnit),indentWithTabs:"tabs"==t.editor_indentWithTabs,smartIndent:"classic"!=t.editor_tabMode,indentByTab:"indent"==t.editor_tabMode,electricChars:"true"==t.editor_electricChars.toString(),lineNumbers:!0,lineWrapping:t.editor_lineWrapping,extraKeys:{Enter:"newlineAndIndentContinueComment"},keyMap:t.editor_keyMap,bookmarkGutter:!0,gutters:["gutter","CodeMirror-linenumbers","CodeMirror-foldgutter","CodeMirror-lint-markers","CodeMirror-bookmarks"],
matchBrackets:!0,foldGutter:!0,styleActiveLine:!0,specifyMoreJsTokens:f,styleSelectedText:!0,autoTrimTrailingSpace:"true"==t.editor_trimTrailingSpacesFromModifiedLines.toString(),hintOptions:f?{keywords:Ba.globals}:void 0,lint:f?{lintOnChange:t.editor_autoLint,async:t.editor_autoLint,getAnnotations:ba,globals:Ba.globals,jshint_options:Ba.options}:void 0,showTrailingSpace:t.editor_highlightTrailingWhitespace},{save:K,close:A},{change:l,blur:J},e.getMessage)}else d.editor=b,b.value=a.code;if(c.on_editor_load)c.on_editor_load()}}).fail(function(){A(null,
!1,!0)})},onClose:function(b){var c=function(){d.editor=null;delete u[a.uuid].lastI};if(!b&&E())return(b=confirm(e.getMessage("There_are_unsaved_changed_")))&&c(),!b;c();return!1}};return W["editor"+a.uuid]=b},pb=function(a,b,c){u[a.uuid]||(u[a.uuid]={});var d,h,f=a.icon&&!a.nativeScript,l=[];a.nativeScript||l.push("clickable");a.blacklisted&&l.push("crossedout");var m=g("span",l.join(" "),a.uuid,"sname"),k=g(f?"img":"span","nameNicon16 icon16",a.uuid,"sname_img"),r=g("span",(f?"nameNname16":"nameNOname16")+
" "+(a.enabled?"":"greyed"),a.uuid,"sname_name");m.appendChild(k);var l=Ja(a),n=e.getTranslation(a,"name");r.textContent=n;var q=w("span",a.uuid,"spos");q.textContent=a.position||"";n=w("span",a.uuid,"sversion");n.textContent=a.version?a.version:"";f&&(k.src=a.icon);var f=[],k=function(a,b,c){var d=g("span",c||"",a.uuid,"wrap");b&&("Array"===v.toType(b)?v.each(b,function(a){d.appendChild(a)}):d.appendChild(b));return d},K=function(){window.setTimeout(function(){for(var d=Object.keys(U),e,h=0;e=d[h];h++)if(e=
U[e].script,e.uuid==a.uuid){wa(b,[e],null,c);break}Ga()},1)},A=function(b,c){void 0===c&&(c=!b);a.uuid&&M.is(a.uuid)&&M.clear();h&&h.onClose&&h.onClose(b)||(d&&(d.remove(),d=null),delete W["tab"+a.uuid],delete W["editor"+a.uuid],m.parentNode&&m.parentNode.removeChild(m),c&&K())},y=function(){h&&h.afterSelect&&h.afterSelect()},G=u[a.uuid].scriptClick=function(k,f){if(!d){var l=null;a.nnew?(l=g("div","head_icon",a.uuid,"details_h"),l.appendChild(p.createIcon(a.image_id,"",a.uuid,"new_script_head"))):
l=w("div",a.uuid,"details_h");var m=w("div",a.uuid,"details_c");d=c.insertTab(null,a.uuid,l,m,y,a.nnew?null:A);a.nnew||d.setHeading(e.getMessage("Edit")+" - "+e.getTranslation(a,"name"),50);h=Bb(d,a,b,m,A)}if(h&&h.onShow)h.onShow();d.show();k&&1==k.button||f||d.select();r.setAttribute("open","true")};"true"==r.getAttribute("open")&&G(null,!0);var D=function(a,b){var c=a.getTime(),d=b.getTime(),e=Math.abs(c-d),c=Math.round(e/6E4),d=Math.round(e/36E5),e=Math.round(e/864E5);return 60>=c?c+" min":48>=
d?d+" h":e+" d"},x=w("span","",a.uuid,"last_updated",!0),I="?";if(a.nativeScript||a.nnew||a.system)I="";else if(u[a.uuid].scriptUpdate=function(){var b=x.textContent;x.textContent="";x.appendChild(p.createIcon(C.get("download"),"down",a.uuid,"spinner"));Hb(a.uuid,function(c){x.textContent=b;c?($(x).addClass("green"),x.title=e.getMessage("There_is_an_update_for_0name0_avaiable_",a.name),A(!0),eb()):($(x).addClass("red"),x.title=e.getMessage("No_update_found__sry_"))})},a.options.check_for_updates&&
a.file_url?(x.addEventListener("click",function(){P(a.uuid,"scriptUpdate")}),x.setAttribute("class","clickable"),x.title=e.getMessage("Check_for_Updates")):(x.setAttribute("class","greyed italic"),x.title=e.getMessage("Update_check_is_disabled")),a.lastModified||a.lastUpdated)try{I=D(new Date,new Date(a.lastModified||a.lastUpdated))}catch(N){console.log("o: error calculating time "+N.message)}x.textContent=I;var L=w("div",a.uuid,"imported"),Q="";H.push(function(){t.sync_enabled&&(Q=a.nativeScript||
a.nnew||a.system?"":a.sync&&a.sync.imported?a.sync.imported==Pa.types.eCHROMESYNC?'<img src="https://www.google.com/images/icons/product/chrome-16.png" class="icon16" title="Google Sync"/>':a.sync.imported==Pa.types.eGDRIVE?'<img src="https://www.google.com/images/icons/product/drive-16.png" class="icon16" title="Google Drive"/>':'<img src="'+rea.extension.getURL("/layout/default/images/update.png")+'" class="icon16" />':"",L.innerHTML=Q,L=null)});var F,D=w("span",a.uuid,"hp");if(a.origin){F=w("a",
a.uuid,"hp_origin");F.setAttribute("href",a.origin.url);F.setAttribute("target","_blank");var B=p.createImage(C.origin(a.origin.token),"",a.uuid,a.origin.token);F.appendChild(B);D.appendChild(F)}!l||a.origin&&a.origin.url===l||(F=w("a",a.uuid,"hp_script"),F.setAttribute("href",l),F.setAttribute("target","_blank"),B=p.createIcon(C.get("home"),"",a.uuid,"homepage",""),F.appendChild(B),D.appendChild(F));u[a.uuid].saveEm_lastModTime=a.lastModified;u[a.uuid].fullReset=function(c){La(a.uuid,null,{clean:!0,
reload:!0}).done(c||function(){});b.parentNode.removeChild(b)};u[a.uuid].reportAnIssue=function(b){Ib(a.uuid,b)};u[a.uuid].deleteScript=function(c,d){var h;a.nativeScript?(h=d||confirm(e.getMessage("Really_delete_0name0__",a.name)),1==h&&(Ma(a.uuid,"installed","false"),b.parentNode.removeChild(b))):(h=d||confirm(e.getMessage("Really_delete_0name0__",a.name)),1==h&&(La(a.uuid,null,{reload:!d}),b.parentNode.removeChild(b)))};F=[];if(a.nativeScript){u[a.uuid].importNativeScript=function(c,d){1==(d||
confirm(e.getMessage("Really_import_0name0__",a.name)))&&(Ma(a.uuid,"imported","true"),b.parentNode.removeChild(b))};var O=p.createIcon(C.get("import"),"",a.uuid,"import",e.getMessage("Import"),function(){P(a.uuid,"importNativeScript")});p.addClass(O,"hidden");F.push(O);H.push(function(){t.native_import&&p.toggleClass(O,"hidden")})}!a.nnew&&!a.system&&a.origin&&a.origin.abuse_url&&(B=p.createIcon(C.get("flag"),"",a.uuid,"issue",e.getMessage("Report_an_issue_to_the_script_hoster_"),function(){P(a.uuid,
"reportAnIssue","hoster")}),F.push(B));a.nnew||a.system||!a.origin&&!a.supportURL||(B=p.createIcon(C.get("bug"),"",a.uuid,"bug",e.getMessage("Report_a_bug"),function(){P(a.uuid,"reportAnIssue","author")}),F.push(B));a.nnew||a.system||a.nativeScript||(B=p.createIcon(C.get("edit"),"",a.uuid,"edit",e.getMessage("Edit"),function(){P(a.uuid,"scriptClick")}),F.push(B));a.nnew||a.system||(B=p.createIcon(C.get("delete"),"",a.uuid,"delete",e.getMessage("Delete"),function(){P(a.uuid,"deleteScript")}),F.push(B));
z.RUNTIME.MOBILE?m.inserted||a.nativeScript||r.addEventListener("click",function(){$(b).toggleClass("show_details")}):m.inserted||a.nativeScript||(m.addEventListener("click",G),m.addEventListener("auxclick",G));m.appendChild(r);B=[a.name];a.description&&B.push(e.getTranslation(a,"description"));a.blacklisted&&(B=[e.getMessage("This_script_is_blacklisted_")]);m.title=B.join("\n\n").replace(/\"/g,'"');f.push(a.nnew||a.system?null:{element:Jb(a),style:"script_sel"});f.push(q);f.push(function(){var b=
null,b=a.blacklisted?"enabler_warning":a.enabled?a.contexter?"enabler_enabled enabler_later":"enabler_enabled":"enabler_disabled",c=a.blacklisted?e.getMessage("This_script_is_blacklisted_"):a.enabled?e.getMessage("Enabled"):e.getMessage("Disabled"),b=p.createEnabler(b,a.uuid,"enabled",{append:"enabled",disabled:a.blacklisted,title:c},function(){P(a.uuid,a.nativeScript?"switchNativeEnabled":"switchEnabled")});u[a.uuid].switchEnabled=function(b,c,d){void 0===c&&(c=!a.enabled);ia(a.uuid,{enabled:c},
d)};u[a.uuid].switchNativeEnabled=function(b,c,d){void 0===c&&(c=!a.enabled);Ma(a.uuid,"enabled",c,d)};return b}());f.push({element:m,style:"script_name"});if(z.RUNTIME.MOBILE){q=function(b,c,d,e){var h=g("dt","script_info "+(e?e:""),a.name,a.uuid,"dt_mapping"+c);e=g("dd","script_info "+(e?e:""),a.name,a.uuid,"dd_mapping"+c);h.textContent=c;"string"===typeof d?e.textContent=d:e.appendChild(d);b.appendChild([h,e])};B=g("dl","script_details",a.name,a.uuid,"script_details_dl");m.appendChild(B);q(B,e.getMessage("Version"),
n);q(B,e.getMessage("Type"),fb(a),"script_type");q(B,e.getMessage("Sites"),gb(a));var J;(J=hb(a))&&q(B,e.getMessage("Features"),J);l&&q(B,e.getMessage("Homepage"),D);I&&q(B,e.getMessage("Last_updated"),x);f.push(k(a,F,"actions"))}else for(f.push({element:n,style:"script_version"}),f.push(fb(a)),f.push(L),f.push(gb(a)),f.push(hb(a)),f.push(D),f.push(x),f.push(Kb(a)),f.push(k(a,F,"actions")),J=f.length;10>J;J++)f.push(null);M.registerListener(a.uuid,function(){G()});a.nnew&&H.push(function(){G(null,
!0)});return f},fb=function(a){var b=g("span","script_type","",a.uuid,"pos_type",!0);if(a.nnew)return b;a.nativeScript?(a=p.createImage(a.icon,"",a.uuid,"chrome_ext",e.getMessage("This_is_a_chrome_extension")),b.appendChild(a)):a.userscript&&(a=p.createImage(C.origin("uso"),"",a.uuid,"user_script",e.getMessage("This_is_a_userscript")),b.appendChild(a));return b},hb=function(a){var b,c,d,h=null,f=[];if(a.nnew)return null;a.system&&(b=p.createIcon(C.get("lock"),"",a.uuid,"lock",e.getMessage("This_is_a_system_script")),
f.push(b));a.warnings&&a.warnings.forEach(function(c,d){b=p.createIcon(C.get("critical"),"compat",a.uuid,"warning_"+d,c);$(b).addClass("flashing");f.push(b)});if(a.awareOfChrome||a.nativeScript)b=p.createImage("https://www.google.com/images/icons/product/chrome-16.png","",a.uuid,"chrome_mode",e.getMessage("This_script_runs_in_Chrome_mode")),f.push(b);if(a.nativeScript)return h;a.requires.length&&(d=!a.requires.filter(function(a){return a.modified}).length,b=p.createIcon(C.get("script_download")+(d?
"":" red"),"",a.uuid,"requires",v.map(v.select(a.requires,function(a){return a&&a.url}),function(a){return a.url}).join("\n"),function(){M.set(a.uuid,"externals")}),f.push(b));a.resources.length&&(d=!a.resources.filter(function(a){return a.modified}).length,b=p.createIcon(C.get("resources")+(d?"":" red"),"",a.uuid,"resources",v.map(v.select(a.resources,function(a){return a&&a.url}),function(a){return a.url}).join("\n"),function(){M.set(a.uuid,"externals")}),f.push(b));d=!1;var l={includes:!0,matches:!0};
for(c in l)if(a[c]){for(l=0;l<a[c].length;l++)if(a[c][l]&&(0==a[c][l].search(/\/\^?http(s|\.\*?|s\?|\[[^\]]*s[^\]]*\]|\([^\)]*s[^\)]*\))+/)||0==a[c][l].search(/http[s\*]{1,1}|\*/))){b=p.createIcon(C.get("encrypted"),"",a.uuid,"encrypt",e.getMessage("This_script_has_access_to_https_pages"));f.push(b);d=!0;break}if(d)break}var g={};a.grant.forEach(function(a){g[a]=!0});g.GM_xmlhttpRequest&&(b=p.createIcon(C.get("web"),"",a.uuid,"web",e.getMessage("This_script_has_full_web_access")),f.push(b));g.GM_setValue&&
(b=p.createIcon(C.get("db"),"",a.uuid,"db",e.getMessage("This_script_stores_data")),f.push(b));g.unsafeWindow&&(b=p.createIcon(C.get("windowlist"),"",a.uuid,"unsafeWindow",e.getMessage("This_script_has_access_to_webpage_scripts")),f.push(b));for(c in a.options)if(-1!=c.search("compat_")&&a.options[c]){b=p.createIcon(C.get("critical"),"compat",a.uuid,"crit",e.getMessage("One_or_more_compatibility_options_are_set"));f.push(b);break}f.length&&(h=w("span","",a.uuid,"pos_features",!0),h.appendChild(f,
!0));return h},Wa=function(a){var b="global_hint_"+(a.class?a.class:"warning"),c=Date.now(),d=g("span",["global_hint",b].join(" "),"globalhint",c),b=w("span","globalhint_c",c),e=w("span","globalhint_t",c);a.title&&(e.title=a.title);a.image&&b.appendChild(p.createIcon(C.get(a.image),"globalhint_"+c,"icon"+c));e.textContent=a.text;a.onclick&&!e.inserted&&e.addEventListener("click",a.onclick);b.appendChild(e);d.appendChild(b);var f=$(d).hide().appendTo(document.body);window.setTimeout(function(){f.slideDown()},
f.delay?f.delay:1);a.timeout&&window.setTimeout(function(){f.slideUp(function(){f.remove()});a.done&&a.done(d)},a.timeout);return f},ib=!1,Xa=function(a){if(!ib){var b=e.getLocale(),c=$("<div>").hide(),d=function(a){a?(c.html(""),c.append($('<div class="contrib_iframe" style="font-size: 2.5em;"></div>').append($('<div style="padding-top: 150px;">').text(a))),window.setTimeout(d,1E3)):(c.fadeOut(1E3),window.setTimeout(q.hideDialog,1E3))};a=$('<iframe src="https://tampermonkey.net/contrib.php?embedded=2'+
(b?"&locale="+b:"")+"&src="+(a||"e")+'" class="contrib_iframe"></iframe>');var h=[$('<button class="contrib_button">').html(e.getMessage("Remind_me_later")).click(function(){ja("later");d(e.getMessage("Ok"))}),$('<button class="contrib_button">').html(e.getMessage("I_contributed_already")).click(function(){ja("contributed");d(e.getMessage("Thank_you_very_much_"))}),$('<button class="contrib_button">').html(e.getMessage("I_dont_want_to_contribute")).click(function(){ja("hide");d(e.getMessage("Ok"))})],
f=function(){l&&window.clearTimeout(l);h.forEach(function(a){a.prop("disabled",!1)})};h.forEach(function(a){a.prop("disabled",!0)});c.append(a,h);a.bind("load",f);var l=window.setTimeout(function(){l=null;f()},15E3),g=function(){var a=q.dialog(c[0]);!0===a?(c.fadeIn(1E3),ja("dialog")):void 0===a&&window.setTimeout(g,500);ib=!0};g();window.addEventListener("message",function(a){var b,h=a.data.clicked||a.data.type;b=a.data.amount;var f=a.data.currency,l=a.data.redirect_url;h&&(l&&va(l,!0),a.data.success?
(b=$(".contrib_iframe"),f=b.data("oheight"),!f||0>f||1E3<f||(b.animate({height:f},1E3),ja("contributed",h,{id:a.data.id}))):a.data.clicked&&(ja("clicked",h,{amount:b||"?",currency:f||"?"}),$(".contrib_button").remove(),c.append($('<button class="contrib_button">').html(e.getMessage("Ok")).click(function(){d()})),a.data.enlarge&&(b=$(".contrib_iframe"),b.data("oheight",b.height()),b.animate({height:740},1E3))))},!1)}},Lb=function(){var a=null,b=null,c=null,d=0,e=0,f=0,l=function(b){var d=c.x+b.pageX;
a.style.top=c.y+b.pageY+"px";a.style.left=d+"px"},g,k,r,n=function(c){if(a&&!g){var y,t=null,u,x,v,w;l(c);k&&(window.clearTimeout(k),k=null);for(;t!=f;)t=f,u=b.previousSibling,x=b.nextSibling,v=b.parentNode,w=q(b),c.pageY>w.y+d+e&&x?(v.removeChild(x),v.insertBefore(x,b),f++,y=!1):c.pageY<w.y&&1<f&&(v.removeChild(u),x?v.insertBefore(u,x):v.appendChild(u),f--,y=!0);t=Math.min(.03*document.documentElement.clientHeight,100);if(void 0!==y){x=y?$(u):$(x);if(x.length&&!p.isScrolledIntoView(x,{padding:t})){y=
y?x.offset().top-t-x.height():x.offset().top-document.documentElement.clientHeight+t+2*x.height();g=!0;var z=y-document.body.scrollTop;$("html, body").animate({scrollTop:y},0,function(){window.setTimeout(function(){g=!1;k=window.setTimeout(function(){k=null;r===c&&n({pageX:r.pageX,pageY:r.pageY+z})},100)},100)})}c.stopPropagation&&(c.stopPropagation(),c.preventDefault());r=c;return!1}}},q=function(a){a=a.getBoundingClientRect();return{x:a.left+window.pageXOffset,y:a.top+window.pageYOffset}},t=function(d){a.style.position=
"static";var e={};e[a.key]=f;ia(a.uuid,e);a=b=c=null;document.removeEventListener("mousemove",n);document.removeEventListener("scroll",n);document.removeEventListener("mouseup",t);d.stopPropagation();d.preventDefault();return!1};return{start:function(g,k){var m=this.parentNode.parentNode,r=m.parentNode,p=r.parentNode.parentNode;a=this;b=r;d=b.offsetHeight;e=b.offsetHeight-m.clientHeight;c=q(p);c.x=-c.x-a.offsetWidth/2;c.y=-c.y-b.offsetHeight/2+2*e;a.style.position="absolute";l(g);f=k;document.addEventListener("mousemove",
n);document.addEventListener("scroll",n);document.addEventListener("mouseup",t);g.stopPropagation();g.preventDefault();return!1}}}(),Kb=function(a){var b=g("span","sorting","",a.uuid,"pos_images",!0);if(a.nnew||a.nativeScript)return b;"pos"==da()&&"up"==ha()||b.setAttribute("style","display: none;");if(1<a.position||a.position<a.positionof){var c=g("span","clickable movable","position",a.uuid,!0);c.innerHTML="&#9776;";c.title=e.getMessage("Click_here_to_move_this_script");c.uuid=a.uuid;c.key="position";
c.addEventListener("mousedown",function(b){Lb.start.apply(this,[b,a.position])});b.appendChild(c)}return b},gb=function(a){var b=w("span","",a.uuid,"site_images"),c=null;b.inserted&&(c=b,c.setAttribute("id",c.id+"foo"),b=w("span","",a.uuid,"site_images"));Ha.topIcons(a,7).forEach(function(a){b.appendChild(a,!0)});c&&c.parentNode.removeChild(c);return b},mb=function(a){var b=g("div","search_filter",a.name,a.id,"filter");if(b.inserted)return b;var c=!1;u.filter={onShow:function(a){c||(n.value="",c=
!0);f(!0);a&&$(n).focus()},onHide:function(){c=!1;f(!0,1)}};var d=null,h,f=function(a,b){if(!h||a)d&&window.clearTimeout(d),t.show(),d=window.setTimeout(function(){for(var a=document.getElementsByName("scriptselectors"),b=[],d=0;d<a.length;d++)b.push(a[d]);h=!0;"matching_url"!=m&&"auto"!=m||!n.value.match(l.matching_url.match)?a=D.Pledge():(k=l.matching_url.update_interval||k,a=Mb(n.value));a.always(function(){h=!1;t.fadeOut()}).then(function(a){var d=new RegExp(v.escapeForRegExp(n.value),"i"),e=
n.value;b.forEach(function(b){var h,f,g,k;(h=U[b.s_id])&&(f=h.script)&&(g=h.dom)&&(c?"auto"==m?Object.keys(l).every(function(b){var c=l[b];return"auto"==b?!0:(k=c.check(f,c.ignore_case?d:e,a))?!1:!0}):(h=l[m],k=h.check(f,h.ignore_case?d:e,a)):k=!0,$(g).toggle(!!k),b.is_hidden=!k)})})},b||k)},l={auto:{name:e.getMessage("Auto"),update_interval:500},name:{name:"@name",check:function(a,b){return-1!=a.name.search(b)},ignore_case:!0},namespace:{name:"@namespace",check:function(a,b){return a.namespace&&
-1!=a.namespace.search(b)},ignore_case:!0},author:{name:"@author",check:function(a,b){return a.author&&-1!=a.author.search(b)},ignore_case:!0},grant:{name:"@grant",default:"GM_",check:function(a,b){return a.grant&&0<a.grant.filter(function(a){return-1!=a.search(b)}).length},ignore_case:!0},includes:{name:"@include/@match",check:function(a,b){return a.includes&&0<a.includes.filter(function(a){return-1!=a.search(b)}).length||a.matches&&0<a.matches.filter(function(a){return-1!=a.search(b)}).length},
ignore_case:!0},comment:{name:e.getMessage("Comment"),check:function(a,b){return a.comment&&-1!=a.comment.search(b)},ignore_case:!0},url:{name:e.getMessage("Update_URL_"),default:"https://",check:function(a,b){return a.file_url&&-1!=a.file_url.search(b)},ignore_case:!0},matching_url:{name:e.getMessage("Matching_URL"),update_interval:1500,default:"http://",match:/^https?:\/\/.*/,check:function(a,b,c){return c&&-1!=c.indexOf(a.uuid)}}},m="auto",k=l.auto.update_interval,r=p.createDropDown(e.getMessage("Filter_by"),
{value:0,uuid:"sms-filter",name:"select"},Object.keys(l).map(function(a){return{name:l[a].name,value:a}}),function(){var a;a=this.value;a!=m&&(m=a,k=((a=l[m])?a.update_interval:null)||l.auto.update_interval,a=(a?a.default:null)||"",n.value=n.value||a,f())});r.elem.setAttribute("class","label");var n=g("input","filter_text","sms","all",null);n.setAttribute("spellcheck","false");var q="";n.inserted||n.addEventListener("keyup",function(){q!=n.value&&(q=n.value,f())});var t=$(p.createIcon(C.get("download"),
"wait_for_filter",a.uuid));t.attr("style","vertical-align: middle;");t.hide();b.appendChild(r.elem);b.appendChild(n);b.appendChild(t[0]);X.filter&&H.push(function(){u.multiselect.toggleRow(!0,!0);n.value=X.filter});return b},S=[],Jb=function(a){var b=w("input","",a.uuid,"sel");b.type="checkbox";b.s_id=a.uuid;b.name="scriptselectors";b.s_type=a.nativeScript?"n":"s";b.inserted||b.addEventListener("click",function(a){S=[];b&&S.push(b);a.ctrlKey||a.metaKey?u.multiselect.un_selectAll():u.multiselect.single_click()});
return b},lb=function(a){var b=g("input","multiselectcb","sms","all",null),c=g("div","filter multiselectcb clickable","sms2","all",null);b.inserted||(b.type="checkbox",b.addEventListener("click",u.multiselect.un_selectAll),c.addEventListener("click",function(){u.multiselect.toggleRow()}));var d=0,h=[{name:e.getMessage("__Please_choose__"),value:0},{name:e.getMessage("Enable"),value:1},{name:e.getMessage("Disable"),value:2},{name:e.getMessage("Toggle_Enable"),value:7}];(z.RUNTIME.CAN_SAVEAS_ZIP||"undefined"!==
typeof Blob)&&h.push({name:e.getMessage("Export"),value:3});var h=h.concat([{name:e.getMessage("Trigger_Update"),value:5},{name:e.getMessage("Factory_Reset"),value:8},{name:e.getMessage("Remove"),value:6}]),h=p.createDropDown(e.getMessage("Apply_this_action_to_the_selected_scripts"),{value:0,uuid:"sms-select",name:"select"},h,function(){0==this.value?f.setAttribute("disabled","true"):f.removeAttribute("disabled");d=this.value}),f=p.createButton("MultiSelectButton","start_button",e.getMessage("Start"),
function(){if(0==d)console.log("option: ?!?!");else{var a=null;6==d?a=e.getMessage("Really_delete_the_selected_items_"):8==d&&(a=e.getMessage("Really_factory_reset_the_selected_items_"));if(!a||confirm(a)){for(var b=document.getElementsByName("scriptselectors"),c=[],a=0;a<b.length;a++)c.push(b[a]);for(var b={},h,f=!1,g=100,a=0;a<c.length;a++)if(c[a].checked&&!c[a].is_hidden)if(1==d||2==d||7==d){h="n"==c[a].s_type?"switchNativeEnabled":"switchEnabled";var p;if(7==d){var t=U[c[a].s_id]?U[c[a].s_id].script:
null;t&&(p=!t.enabled)}else p=1==d;void 0!==p&&(P(c[a].s_id,h,null,p,!1),f=!0)}else 3==d?b[c[a].s_id]=!0:5==d?(h="scriptUpdate",P(c[a].s_id,h)):6==d?(h="deleteScript",P(c[a].s_id,h,null,!0),f=!0,g=1500):8==d&&(h="fullReset",P(c[a].s_id,h),f=!0,g=1500);3==d&&(q.wait(),xa(b,{storage:ea}).then(function(a){q.wait();return z.RUNTIME.CAN_SAVEAS_ZIP?aa.zip.create(a.scripts).progress(q.wait):aa.json.create(a.scripts).then(function(a){return new Blob([a],{type:"text/plain"})})}).then(function(a){return ra().done(function(){saveAs(a,
"tampermonkey_scripts"+(z.RUNTIME.CAN_SAVEAS_ZIP?".zip":".txt"))})}).always(function(){q.hide()}));f&&(q.wait(e.getMessage("Please_wait___")),window.setTimeout(function(){eb()},g))}}});f.setAttribute("class","action_button");f.setAttribute("disabled","true");h.elem.appendChild(f);a=g("div","actions",a.name,a.id,"actions");a.appendChild(h.elem);h=p.createButton("MultiSelectButton","close_button",e.getMessage("Close"),function(){u.multiselect.toggleRow(!1)});$(h).addClass("close_button");return{selAllm:b,
selAll:c,actionBox:a,close:h}};(function(){var a=0;u.multiselect={};var b=!1;u.multiselect.toggleRow=function(a,d){var e=$(".multiselect");void 0===a&&(a=!b);a?(b=!0,e.addClass("multiselectvisible"),u.filter.onShow(d)):(b=!1,e.removeClass("multiselectvisible"),u.filter.onHide(),u.multiselect.un_selectAll(!1))};u.multiselect.single_click=function(){for(var b=0,d=document.getElementsByName("scriptselectors"),e=!0,f=!1,g=!1,m=!0,k=!1,p=!1,n=0,q=0;q<d.length;q++){"n"==d[q].s_type?(g=!0,e=e&&d[q].checked,
f=f||d[q].checked):"s"==d[q].s_type&&(p=!0,m=m&&d[q].checked,k=k||d[q].checked);var t=$(d[q]).closest("tr");d[q].checked?(n++,t.addClass("selected")):t.removeClass("selected")}!g||!e||p&&!m&&k||(b+=1);!p||!m||g&&!e&&f||(b+=2);b!=a&&(a=b,$(".multiselectcb").prop("checked",0!=b?"checked":""));n&&u.multiselect.toggleRow(!0);u.multiselect.checkScroll&&u.multiselect.checkScroll()};u.multiselect.un_selectAll=function(b){3<++a&&(a=0);var d=!1,e=0,f=document.getElementsByName("scriptselectors");S=[];!0===
b&&(a=2);for(var g=0;g<f.length;g++){var m=$(f[g]).closest("tr");!1===b?(f[g].checked=!1,m.removeClass("selected")):(0!=g||1!=a&&3!=a||"s"!=f[g].s_type||3<++a&&(a=0),d|="s"==f[g].s_type,f[g].checked=3==a||1==a&&"n"==f[g].s_type||2==a&&"s"==f[g].s_type,f[g].checked?(e++,m.addClass("selected"),S.push(f[g])):m.removeClass("selected"));e&&u.multiselect.toggleRow(!0)}void 0===b?1<a&&!d&&(a=0):b||(a=0);$(".multiselectcb").prop("checked",0!=a?"checked":"")}})();var ka=null,L=function(){ka&&(window.clearTimeout(ka),
ka=null)},ya=null,O=function(){Na(e.getMessage("Operation_completed_successfully"),"button_ok","notice")},db=function(a,b){void 0===b&&(b="button_ok");Na(a,b,"information",8E3)},cb=function(a,b){void 0===b&&(b="error");Na(a,b,"warning",8E3)},Na=function(a,b,c,d){void 0===d&&(d=3E3);ya&&$(ya).remove();ya=Wa({text:a,image:b,class:c,delay:500,timeout:d,done:function(){ya=null}})},J=function(){ka||(ka=window.setTimeout(function(){ka=null;q.wait(e.getMessage("Please_wait___"))},500))},sa=null,la=null,
R=function(a,b){null!=sa?(window.clearTimeout(sa),sa=null,R(a?a:la.items,a?b:la.with_scripts)):(la={items:a,with_scripts:b},sa=window.setTimeout(function(){sa=null;la.with_scripts&&(U={});wa(null,la.items,null,I);q.hide();Ga();la=null},50))},Mb=function(a){var b=D();sendMessage({method:"determineScriptsToRun",url:a},function(a){b.resolve(a.scripts||[])});return b.promise()},ja=function(a,b,c){var d=D();sendMessage({method:"begEvent",action:a,type:b,extra:c},function(a){d.resolve(a)});return d.promise()},
va=function(a,b){try{var c=function(){b&&z.OPTIONPAGE.CLOSE_ALLOWED&&window.close()};b?sendMessage({method:"newTab",url:a},c):rea.tabs.getSelected(null,function(d){rea.tabs.sendMessage(d.id,{method:"loadUrl",url:a,newtab:b},c)})}catch(d){console.log("lU: "+d.message)}},vb=function(a,b){var c=D();try{J(),sendMessage({method:"installScript",url:a,reload:b.reload},function(a){L();a.items?(O(),R(a.items,!1)):q.hide();a.err?c.reject(a):c.resolve(a)})}catch(d){console.log("sS: "+d.message),c.reject({err:d.message})}return c.promise()},
sb=function(a,b){var c=D();try{J(),sendMessage({method:"exportToJson",ids:a,options:b},function(a){O();L();q.hide();a.json?c.resolve(a.json):c.reject()})}catch(d){console.log("eJ: "+d.message),c.reject({})}return c.promise()},Ia=function(a,b){var c=D();try{J(),sendMessage({method:"importFromJson",json:a,reload:b.reload},function(a){L();a.reload?window.setTimeout(function(){rea.page.reload()},500):a.items?(O(),R(a.items,!0)):q.hide();a.err?c.reject(a):c.resolve(a)})}catch(d){console.log("sS: "+d.message),
c.reject({err:d.message})}return c.promise()},Gb=function(a,b,c){var d=D();try{c.auto_save||J(),sendMessage({method:"saveExternal",uuid:a,code:b,mimetype:c.mimetype,url:c.url,auto_save:c.auto_save},function(a){c.auto_save||(O(),L());a=a||{};a.items?R(a.items,!0):q.hide();d.resolve(a)})}catch(e){console.log("sS: "+e.message),d.reject({err:e.message})}return d.promise()},La=function(a,b,c){var d=D();void 0===c.reload&&(c.reload=!0);try{var e=c.new_url&&c.new_url!=c.old_url?c.new_url:"";c.auto_save||
J();sendMessage({method:"saveScript",uuid:a,code:b,clean:c.clean,force:c.force,new_script:c.new_script,auto_save:c.auto_save,force_url:e,lastModTime:c.lastModTime,reload:c.reload},function(a){c.auto_save||(O(),L());a=a||{};a.items?R(a.items,!0):q.hide();!b&&c.reload&&q.hide();d.resolve(a)})}catch(f){console.log("sS: "+f.message),d.reject({err:f.message})}return d.promise()},ua=function(a,b,c){var d=D();try{J(),sendMessage({method:"setOption",name:a,value:b},function(a){L();O();t=a.options||t;!c&&
a.items?R(a.items,!1):q.hide();d.resolve(a)})}catch(e){console.log("sO: "+e.message),d.reject({err:e.message})}return d.promise()},ob=function(a,b,c){var d=D();try{J(),sendMessage({method:"buttonPress",name:a,data:b},function(a){L();!c&&a.items?(O(),R(a.items,!1)):q.hide();d.resolve(a)})}catch(e){console.log("sO: "+e.message),d.reject({err:e.message})}return d.promise()},qa=function(a,b){J();sendMessage({method:"loadTree",complete:a.complete,uuid:a.uuid,url:a.url,referrer:a.referrer,layout:a.layout},
function(a){L();t=a.options||t;a.i18n&&e.setLocale(a.i18n);a.items?a.begging&&H.push(function(){window.setTimeout(function(){Xa(a.begging)},100)}):a.error?alert(a.error):confirm(e.getOriginalMessage("An_internal_error_occured_Do_you_want_to_visit_the_forum_"))&&(window.location.href="http://tampermonkey.net/bug");b(a)})},eb=function(){qa({referrer:"options.scripts"},function(a){a.items?R(a.items,!0):q.hide()})},ia=function(a,b,c){void 0==c&&(c=!0);try{a={method:"modifyScriptOptions",uuid:a,reload:c};
for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);J();sendMessage(a,function(a){L();t=a.options||t;a.i18n&&e.setLocale(a.i18n);O();a.items?R(a.items,!0):q.hide()})}catch(g){console.log("mSo: "+g.message)}},Ma=function(a,b,c,d){void 0===d&&(d=!0);try{a={method:"modifyNativeScript",nid:a,actionid:b,value:c,reload:d},J(),sendMessage(a,function(a){L();O();a.items?R(a.items,!0):q.hide()})}catch(e){console.log("mSo: "+e.message)}},ab=function(a,b,c){try{a={method:"saveStorageKey",uuid:a,key:b,value:c,id:"options"},
J(),sendMessage(a,function(){L();O();q.hide()})}catch(d){console.log("sSk: "+d.message)}},ub=function(a,b,c){try{a={method:"download",details:{url:a,name:b,saveAs:!0},id:"options"},J(),sendMessage(a,function(){L();O();q.hide();c()})}catch(d){console.log("dDU: "+d.message)}},Eb=function(a,b){try{J(),sendMessage({method:"buttonPress",name:"externals_delete",scriptuid:a,safe_url:b},function(a){L();O();a.items?R(a.items,!1):q.hide()})}catch(c){console.log("dEx: "+c.message)}},Hb=function(a,b){try{sendMessage({method:"buttonPress",
name:"run_script_updates",scriptuid:a},function(a){O();b&&b(a.updatable)})}catch(c){console.log("rSu: "+c.message)}},Ib=function(a,b,c){try{sendMessage({method:"reportAnIssue",uuid:a,to:b},function(){c&&c()})}catch(d){console.log("rRi: "+d.message)}};rea.extension.onMessage.addListener(function(a,b,c){if("updateOptions"==a.method)t=a.options||t,R(a.items,!1),c({});else if("confirm"==a.method)v.confirm(a.msg,function(a){c({confirm:a})});else if("showMsg"==a.method)v.alert(a.msg),c({});else return!1;
return!0});(function(){qa({referrer:"options",layout:!0},function(a){xb();Ca.applyTheme(a.layout);if(a.options&&a.options.layout_user_css&&"reset"!==X.layout){var b=document.createElement("style");b.innerHTML=a.options.layout_user_css;(document.head||document.body||document.documentElement||document).appendChild(b)}a.items?R(a.items,!1):q.hide()})})()})});
